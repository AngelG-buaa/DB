import{_ as ae}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                *//* empty css                 *//* empty css               *//* empty css                  *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                  */import{a as le,r as V,b as x,v as P,o as se,c as g,d as I,f as e,w as l,a5 as te,e as o,N as re,j as w,t as R,F as C,y as oe,z as j,A as S,aO as de,k as U,aP as ne,Q as ue,Z as ie,E as pe,aQ as me,l as fe,m as ce,a7 as ve,a8 as _e,a6 as ge,n as we,p as be,h as ye,a9 as Ve}from"./index-0407e335.js";import{getMyReservationsApi as Pe}from"./reservation-e2a96893.js";const Re={class:"profile-container"},Ue={class:"profile-content"},Ee={class:"avatar-section"},Ie={class:"info-section"},ke={class:"stat-item"},Fe={class:"stat-value"},Ne={class:"stat-item"},he={class:"stat-value"},xe={class:"stat-item"},Ce={class:"stat-value"},je={class:"stat-item"},Me={class:"stat-value"},Ae={__name:"Profile",setup(qe){const E=le(),k=V(),y=V(),p=V(!1),F=V(!1),N=V(!1),t=x({username:"",realName:"",email:"",phone:"",department:"",studentId:"",major:"",grade:null,employeeId:""}),i=x({currentPassword:"",newPassword:"",confirmPassword:""}),f=x({totalReservations:0,activeReservations:0,completedReservations:0,cancelledReservations:0}),v=P(()=>E.userInfo),T=P(()=>{var a;return{admin:"管理员",teacher:"教师",student:"学生"}[(a=v.value)==null?void 0:a.role]||"未知"}),z=P(()=>{var a;return{admin:"danger",teacher:"warning",student:"success"}[(a=v.value)==null?void 0:a.role]||"info"}),L=P(()=>{const s=new Date().getFullYear();return Array.from({length:6},(a,d)=>s-d)}),D=P(()=>({Authorization:`Bearer ${E.token}`})),G={realName:[{required:!0,message:"请输入真实姓名",trigger:"blur"},{min:2,max:10,message:"姓名长度在 2 到 10 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],department:[{required:!0,message:"请选择学院",trigger:"change"}]},O={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入新密码",trigger:"blur"},{validator:(s,a,d)=>{a!==i.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},M=()=>{const s=v.value;t.username=s.username||"",t.realName=s.real_name||"",t.email=s.email||"",t.phone=s.phone||"",t.department=s.department||"",t.studentId=s.student_id||"",t.major=s.major||"",t.grade=s.grade||null,t.employeeId=s.employee_id||""},$=()=>{p.value=!0},J=()=>{p.value=!1,M()},Q=async()=>{if(k.value)try{await k.value.validate(),F.value=!0;const s={real_name:t.realName,email:t.email,phone:t.phone,department:t.department};v.value.user_type==="student"&&(s.major=t.major,s.grade=t.grade),(await de(s)).code===200&&(await E.getUserInfo(),p.value=!1,U.success("个人资料更新成功"))}catch(s){console.error("更新个人资料失败:",s)}finally{F.value=!1}},Y=async()=>{if(y.value)try{await y.value.validate(),N.value=!0,(await ne({current_password:i.currentPassword,new_password:i.newPassword})).code===200&&(A(),U.success("密码修改成功"))}catch(s){console.error("修改密码失败:",s)}finally{N.value=!1}},A=()=>{i.currentPassword="",i.newPassword="",i.confirmPassword="",y.value&&y.value.clearValidate()},H=s=>{s.code===200&&(E.updateUserInfo({avatar:s.data.url}),U.success("头像更新成功"))},Z=s=>{const a=s.type==="image/jpeg"||s.type==="image/png",d=s.size/1024/1024<2;return a?d?!0:(U.error("头像图片大小不能超过 2MB!"),!1):(U.error("头像图片只能是 JPG/PNG 格式!"),!1)},K=async()=>{try{const s=await Pe({page:1,page_size:100});if(s.code===200){const a=s.data.list||[];f.totalReservations=a.length,f.activeReservations=a.filter(d=>d.status==="confirmed"||d.status==="approved").length,f.completedReservations=a.filter(d=>d.status==="completed").length,f.cancelledReservations=a.filter(d=>d.status==="cancelled").length}}catch{}};return se(()=>{M(),K()}),(s,a)=>{const d=ue,W=ie,b=pe,X=me,m=fe,n=ce,u=ve,ee=_e,_=ge,c=we,q=be,B=ye,h=te;return g(),I("div",Re,[e(h,{class:"profile-card"},{header:l(()=>[...a[12]||(a[12]=[o("div",{class:"card-header"},[o("span",null,"个人资料")],-1)])]),default:l(()=>[o("div",Ue,[o("div",Ee,[e(W,{size:120,src:v.value.avatar,class:"user-avatar"},{default:l(()=>[e(d,null,{default:l(()=>[e(re(Ve))]),_:1})]),_:1},8,["src"]),e(X,{class:"avatar-uploader",action:"/api/upload/avatar",headers:D.value,"show-file-list":!1,"on-success":H,"before-upload":Z},{default:l(()=>[e(b,{size:"small",type:"primary"},{default:l(()=>[...a[13]||(a[13]=[w("更换头像",-1)])]),_:1})]),_:1},8,["headers"])]),o("div",Ie,[e(B,{ref_key:"profileFormRef",ref:k,model:t,rules:G,"label-width":"100px",class:"profile-form"},{default:l(()=>[e(_,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"用户名"},{default:l(()=>[e(m,{modelValue:t.username,"onUpdate:modelValue":a[0]||(a[0]=r=>t.username=r),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(n,{label:"用户类型"},{default:l(()=>[e(ee,{type:z.value},{default:l(()=>[w(R(T.value),1)]),_:1},8,["type"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"真实姓名",prop:"realName"},{default:l(()=>[e(m,{modelValue:t.realName,"onUpdate:modelValue":a[1]||(a[1]=r=>t.realName=r),disabled:!p.value,clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(n,{label:"邮箱",prop:"email"},{default:l(()=>[e(m,{modelValue:t.email,"onUpdate:modelValue":a[2]||(a[2]=r=>t.email=r),disabled:!p.value,clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"手机号",prop:"phone"},{default:l(()=>[e(m,{modelValue:t.phone,"onUpdate:modelValue":a[3]||(a[3]=r=>t.phone=r),disabled:!p.value,clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(n,{label:"学院",prop:"department"},{default:l(()=>[e(q,{modelValue:t.department,"onUpdate:modelValue":a[4]||(a[4]=r=>t.department=r),disabled:!p.value,placeholder:"请选择学院",style:{width:"100%"}},{default:l(()=>[e(c,{label:"计算机科学与技术学院",value:"计算机科学与技术学院"}),e(c,{label:"电子工程学院",value:"电子工程学院"}),e(c,{label:"物理学院",value:"物理学院"}),e(c,{label:"化学学院",value:"化学学院"}),e(c,{label:"生物学院",value:"生物学院"}),e(c,{label:"数学学院",value:"数学学院"}),e(c,{label:"材料科学与工程学院",value:"材料科学与工程学院"})]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),v.value.user_type==="student"?(g(),I(C,{key:0},[e(_,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"学号"},{default:l(()=>[e(m,{modelValue:t.studentId,"onUpdate:modelValue":a[5]||(a[5]=r=>t.studentId=r),disabled:""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:12},{default:l(()=>[e(n,{label:"专业",prop:"major"},{default:l(()=>[e(m,{modelValue:t.major,"onUpdate:modelValue":a[6]||(a[6]=r=>t.major=r),disabled:!p.value,clearable:""},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),e(_,{gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"年级",prop:"grade"},{default:l(()=>[e(q,{modelValue:t.grade,"onUpdate:modelValue":a[7]||(a[7]=r=>t.grade=r),disabled:!p.value,placeholder:"请选择年级",style:{width:"100%"}},{default:l(()=>[(g(!0),I(C,null,oe(L.value,r=>(g(),j(c,{key:r,label:`${r}级`,value:r},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1})],64)):S("",!0),v.value.user_type==="teacher"?(g(),j(_,{key:1,gutter:20},{default:l(()=>[e(u,{span:12},{default:l(()=>[e(n,{label:"工号"},{default:l(()=>[e(m,{modelValue:t.employeeId,"onUpdate:modelValue":a[8]||(a[8]=r=>t.employeeId=r),disabled:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):S("",!0),e(n,null,{default:l(()=>[p.value?(g(),I(C,{key:1},[e(b,{type:"primary",loading:F.value,onClick:Q},{default:l(()=>[...a[15]||(a[15]=[w(" 保存 ",-1)])]),_:1},8,["loading"]),e(b,{onClick:J},{default:l(()=>[...a[16]||(a[16]=[w("取消",-1)])]),_:1})],64)):(g(),j(b,{key:0,type:"primary",onClick:$},{default:l(()=>[...a[14]||(a[14]=[w(" 编辑资料 ",-1)])]),_:1}))]),_:1})]),_:1},8,["model"])])])]),_:1}),e(h,{class:"password-card"},{header:l(()=>[...a[17]||(a[17]=[o("div",{class:"card-header"},[o("span",null,"修改密码")],-1)])]),default:l(()=>[e(B,{ref_key:"passwordFormRef",ref:y,model:i,rules:O,"label-width":"100px",class:"password-form"},{default:l(()=>[e(n,{label:"当前密码",prop:"currentPassword"},{default:l(()=>[e(m,{modelValue:i.currentPassword,"onUpdate:modelValue":a[9]||(a[9]=r=>i.currentPassword=r),type:"password",placeholder:"请输入当前密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),e(n,{label:"新密码",prop:"newPassword"},{default:l(()=>[e(m,{modelValue:i.newPassword,"onUpdate:modelValue":a[10]||(a[10]=r=>i.newPassword=r),type:"password",placeholder:"请输入新密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),e(n,{label:"确认密码",prop:"confirmPassword"},{default:l(()=>[e(m,{modelValue:i.confirmPassword,"onUpdate:modelValue":a[11]||(a[11]=r=>i.confirmPassword=r),type:"password",placeholder:"请再次输入新密码","show-password":"",clearable:""},null,8,["modelValue"])]),_:1}),e(n,null,{default:l(()=>[e(b,{type:"primary",loading:N.value,onClick:Y},{default:l(()=>[...a[18]||(a[18]=[w(" 修改密码 ",-1)])]),_:1},8,["loading"]),e(b,{onClick:A},{default:l(()=>[...a[19]||(a[19]=[w("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(h,{class:"stats-card"},{header:l(()=>[...a[20]||(a[20]=[o("div",{class:"card-header"},[o("span",null,"账户统计")],-1)])]),default:l(()=>[e(_,{gutter:20,class:"stats-row"},{default:l(()=>[e(u,{span:6},{default:l(()=>[o("div",ke,[o("div",Fe,R(f.totalReservations),1),a[21]||(a[21]=o("div",{class:"stat-label"},"总预约次数",-1))])]),_:1}),e(u,{span:6},{default:l(()=>[o("div",Ne,[o("div",he,R(f.activeReservations),1),a[22]||(a[22]=o("div",{class:"stat-label"},"进行中预约",-1))])]),_:1}),e(u,{span:6},{default:l(()=>[o("div",xe,[o("div",Ce,R(f.completedReservations),1),a[23]||(a[23]=o("div",{class:"stat-label"},"已完成预约",-1))])]),_:1}),e(u,{span:6},{default:l(()=>[o("div",je,[o("div",Me,R(f.cancelledReservations),1),a[24]||(a[24]=o("div",{class:"stat-label"},"已取消预约",-1))])]),_:1})]),_:1})]),_:1})])}}},He=ae(Ae,[["__scopeId","data-v-456f392d"]]);export{He as default};
