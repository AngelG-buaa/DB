import{_ as I}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                *//* empty css                 *//* empty css                  *//* empty css                             *//* empty css                  *//* empty css                        *//* empty css               *//* empty css                  */import{u as N,r as d,b as z,o as L,c as s,d as _,f as t,w as r,k as i,a5 as R,e as v,F as x,y as E,z as w,j as C,l as j,m as A,n as S,p as O,aj as P,ap as T,E as G,h as H}from"./index-0407e335.js";import{getLabsApi as J}from"./lab-ae8b6f89.js";import{getCoursesApi as K}from"./course-750d183b.js";import{c as Q}from"./consumable-97bf65e8.js";const W={class:"consumable-create"},X={__name:"Create",setup(Z){const c=N(),b=d(),m=d(!1),f=d([]),g=d([]),l=z({name:"",model:"",lab_id:null,unit:"个",unit_price:0,current_stock:0,min_stock:0,supplier:"",purchase_date:"",description:"",course_id:null}),U={name:[{required:!0,message:"请输入耗材名称",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],model:[{required:!0,message:"请输入型号/规格",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],lab_id:[{required:!0,message:"请选择实验室",trigger:"change"}],unit:[{required:!0,message:"请输入单位",trigger:"blur"}],unit_price:[{required:!0,message:"请输入单价",trigger:"blur"}],current_stock:[{required:!0,message:"请输入当前库存",trigger:"blur"}],min_stock:[{required:!0,message:"请输入最低库存",trigger:"blur"}],purchase_date:[{required:!0,message:"请选择采购日期",trigger:"change"}]},q=async()=>{try{const o=await J({page:1,page_size:200});o.code===200&&(f.value=(o.data.list||[]).map(e=>({lab_id:e.id,lab_name:e.name})))}catch{i.error("加载实验室列表失败")}},Y=async()=>{try{const o=await K({page:1,page_size:200});o.code===200&&(g.value=(o.data.list||[]).map(e=>({course_id:e.id,course_name:e.name})))}catch{i.error("加载课程列表失败")}},h=async()=>{try{await b.value.validate(),m.value=!0;const o={name:l.name,model:l.model,laboratory_id:l.lab_id,unit:l.unit,unit_price:l.unit_price,current_stock:l.current_stock,min_stock:l.min_stock,supplier:l.supplier,purchase_date:l.purchase_date,description:l.description};await Q(o),i.success("耗材创建成功"),c.push("/consumable/list")}catch(o){o!==!1&&i.error("创建失败，请重试")}finally{m.value=!1}},M=()=>{c.back()};return L(()=>{q(),Y()}),(o,e)=>{const n=j,u=A,V=S,k=O,p=P,B=T,y=G,D=H,F=R;return s(),_("div",W,[t(F,null,{header:r(()=>[...e[11]||(e[11]=[v("div",{class:"card-header"},[v("span",null,"新增耗材")],-1)])]),default:r(()=>[t(D,{ref_key:"formRef",ref:b,model:l,rules:U,"label-width":"120px",class:"consumable-form"},{default:r(()=>[t(u,{label:"耗材名称",prop:"name"},{default:r(()=>[t(n,{modelValue:l.name,"onUpdate:modelValue":e[0]||(e[0]=a=>l.name=a),placeholder:"请输入耗材名称",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(u,{label:"型号/规格",prop:"model"},{default:r(()=>[t(n,{modelValue:l.model,"onUpdate:modelValue":e[1]||(e[1]=a=>l.model=a),placeholder:"请输入型号或规格",maxlength:"100"},null,8,["modelValue"])]),_:1}),t(u,{label:"所属实验室",prop:"lab_id"},{default:r(()=>[t(k,{modelValue:l.lab_id,"onUpdate:modelValue":e[2]||(e[2]=a=>l.lab_id=a),placeholder:"请选择实验室",filterable:""},{default:r(()=>[(s(!0),_(x,null,E(f.value,a=>(s(),w(V,{key:a.lab_id,label:a.lab_name,value:a.lab_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"单位",prop:"unit"},{default:r(()=>[t(n,{modelValue:l.unit,"onUpdate:modelValue":e[3]||(e[3]=a=>l.unit=a),placeholder:"如：个、瓶、包"},null,8,["modelValue"])]),_:1}),t(u,{label:"单价",prop:"unit_price"},{default:r(()=>[t(p,{modelValue:l.unit_price,"onUpdate:modelValue":e[4]||(e[4]=a=>l.unit_price=a),min:0,precision:2,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"当前库存",prop:"current_stock"},{default:r(()=>[t(p,{modelValue:l.current_stock,"onUpdate:modelValue":e[5]||(e[5]=a=>l.current_stock=a),min:0,precision:2,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"最低库存",prop:"min_stock"},{default:r(()=>[t(p,{modelValue:l.min_stock,"onUpdate:modelValue":e[6]||(e[6]=a=>l.min_stock=a),min:0,precision:2,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"供应商"},{default:r(()=>[t(n,{modelValue:l.supplier,"onUpdate:modelValue":e[7]||(e[7]=a=>l.supplier=a),placeholder:"请输入供应商名称"},null,8,["modelValue"])]),_:1}),t(u,{label:"采购日期",prop:"purchase_date"},{default:r(()=>[t(B,{modelValue:l.purchase_date,"onUpdate:modelValue":e[8]||(e[8]=a=>l.purchase_date=a),type:"date",placeholder:"请选择采购日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(u,{label:"描述"},{default:r(()=>[t(n,{modelValue:l.description,"onUpdate:modelValue":e[9]||(e[9]=a=>l.description=a),type:"textarea",rows:3,placeholder:"请输入耗材描述"},null,8,["modelValue"])]),_:1}),t(u,{label:"课程关联",prop:"course_id"},{default:r(()=>[t(k,{modelValue:l.course_id,"onUpdate:modelValue":e[10]||(e[10]=a=>l.course_id=a),placeholder:"请选择关联课程（可选）",filterable:"",clearable:""},{default:r(()=>[(s(!0),_(x,null,E(g.value,a=>(s(),w(V,{key:a.course_id,label:a.course_name,value:a.course_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:r(()=>[t(y,{type:"primary",onClick:h,loading:m.value},{default:r(()=>[...e[12]||(e[12]=[C(" 创建 ",-1)])]),_:1},8,["loading"]),t(y,{onClick:M},{default:r(()=>[...e[13]||(e[13]=[C("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},pe=I(X,[["__scopeId","data-v-63d2946d"]]);export{pe as default};
