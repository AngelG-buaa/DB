import{_ as R}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  */import{u as q,r as b,b as z,o as Q,c as u,d as E,f as a,w as l,k as _,a5 as G,e as m,N as H,j as d,F as J,y as K,z as k,ai as W,t as X,P as Y,Q as Z,E as ee,l as ae,m as te,n as oe,p as le,h as ne,ak as se,a8 as re,al as ie,am as de,aq as pe,ae as ce}from"./index-0407e335.js";import{getCoursesApi as ue,deleteCourseApi as _e}from"./course-750d183b.js";import{getUsersApi as me}from"./user-08aa0f2d.js";const fe={class:"course-list"},ge={class:"card-header"},he={class:"search-area"},be={class:"pagination"},ye={__name:"List",setup(ve){const f=q(),g=b(!1),y=b([]),v=b([]),r=z({course_name:"",teacher_id:null}),n=z({page:1,size:20,total:0}),p=async()=>{try{g.value=!0;const t={page:n.page,page_size:n.size,search:r.course_name||void 0,teacher_id:r.teacher_id||void 0},e=await ue(t);e.code===200&&(y.value=(e.data.list||[]).map(c=>{var s;return{course_id:c.id,course_name:c.name,teacher_name:((s=c.teacher)==null?void 0:s.name)||"",credit:c.credits,need_lab:!1,lab_name:""}}),n.total=e.data.total||0)}catch{_.error("加载课程列表失败")}finally{g.value=!1}},w=async()=>{try{const t=await me({page:1,page_size:100,role:"teacher"});t.code===200&&(v.value=(t.data.list||[]).map(e=>({user_id:e.id,user_name:e.name||e.username})))}catch{_.error("加载教师列表失败")}},x=()=>{n.page=1,p()},V=()=>{Object.assign(r,{course_name:"",teacher_id:null}),n.page=1,p()},B=()=>{f.push("/course/create")},S=t=>{f.push(`/course/edit/${t.course_id}`)},T=t=>{f.push(`/course/${t.course_id}/students`)},L=async t=>{try{await Y.confirm(`确定要删除课程"${t.course_name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _e(t.course_id),_.success("删除成功"),p()}catch(e){e!=="cancel"&&_.error("删除失败")}},$=t=>{n.size=t,n.page=1,p()},F=t=>{n.page=t,p()};return Q(()=>{p(),w()}),(t,e)=>{const c=Z,s=ee,I=ae,h=te,U=oe,D=le,N=ne,i=se,j=re,A=ie,M=de,P=G,O=pe;return u(),E("div",fe,[a(P,null,{header:l(()=>[m("div",ge,[e[5]||(e[5]=m("span",null,"课程管理",-1)),a(s,{type:"primary",onClick:B},{default:l(()=>[a(c,null,{default:l(()=>[a(H(ce))]),_:1}),e[4]||(e[4]=d(" 新增课程 ",-1))]),_:1})])]),default:l(()=>[m("div",he,[a(N,{model:r,inline:""},{default:l(()=>[a(h,{label:"课程名称"},{default:l(()=>[a(I,{modelValue:r.course_name,"onUpdate:modelValue":e[0]||(e[0]=o=>r.course_name=o),placeholder:"请输入课程名称",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(h,{label:"授课教师"},{default:l(()=>[a(D,{modelValue:r.teacher_id,"onUpdate:modelValue":e[1]||(e[1]=o=>r.teacher_id=o),placeholder:"请选择教师",clearable:"",filterable:""},{default:l(()=>[(u(!0),E(J,null,K(v.value,o=>(u(),k(U,{key:o.user_id,label:o.user_name,value:o.user_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(h,null,{default:l(()=>[a(s,{type:"primary",onClick:x},{default:l(()=>[...e[6]||(e[6]=[d("搜索",-1)])]),_:1}),a(s,{onClick:V},{default:l(()=>[...e[7]||(e[7]=[d("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),W((u(),k(A,{data:y.value,stripe:"",style:{width:"100%"}},{default:l(()=>[a(i,{prop:"course_id",label:"课程ID",width:"80"}),a(i,{prop:"course_name",label:"课程名称","min-width":"150"}),a(i,{prop:"teacher_name",label:"授课教师",width:"120"}),a(i,{prop:"credit",label:"学分",width:"80"}),a(i,{prop:"need_lab",label:"需要实验室",width:"100"},{default:l(({row:o})=>[a(j,{type:o.need_lab?"success":"info"},{default:l(()=>[d(X(o.need_lab?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),a(i,{prop:"lab_name",label:"关联实验室","min-width":"120"}),a(i,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[a(s,{type:"primary",size:"small",onClick:C=>S(o)},{default:l(()=>[...e[8]||(e[8]=[d(" 编辑 ",-1)])]),_:1},8,["onClick"]),a(s,{type:"info",size:"small",onClick:C=>T(o)},{default:l(()=>[...e[9]||(e[9]=[d(" 学生列表 ",-1)])]),_:1},8,["onClick"]),a(s,{type:"danger",size:"small",onClick:C=>L(o)},{default:l(()=>[...e[10]||(e[10]=[d(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,g.value]]),m("div",be,[a(M,{"current-page":n.page,"onUpdate:currentPage":e[2]||(e[2]=o=>n.page=o),"page-size":n.size,"onUpdate:pageSize":e[3]||(e[3]=o=>n.size=o),"page-sizes":[10,20,50,100],total:n.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:$,onCurrentChange:F},null,8,["current-page","page-size","total"])])]),_:1})])}}},De=R(ye,[["__scopeId","data-v-2e8096d4"]]);export{De as default};
