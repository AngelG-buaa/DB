import{_ as Le}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                             *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                *//* empty css               *//* empty css                             *//* empty css                  */import{u as Fe,a as Te,r as g,b as F,J as w,v as ue,o as ie,ah as Ae,c as v,d as U,f as e,w as l,a5 as $e,x as Be,e as k,z as h,N as I,j as s,A as H,g as Pe,F as de,y as pe,ai as je,t as i,O as me,k as T,P as Oe,Q as He,E as Ke,l as Je,a7 as Qe,n as We,p as Ge,ap as Xe,a6 as Ze,ak as ea,s as aa,a8 as ta,al as la,am as na,m as oa,aj as ra,h as sa,an as ua,ao as ia,aq as da,ae as pa,ar as ce,as as ma,at as ca}from"./index-0407e335.js";import{g as _a,a as fa,u as ba,c as ga,d as ya}from"./equipment-16832688.js";import{c as va}from"./maintenance-0ef2aad3.js";import{getLabsApi as Va}from"./lab-ae8b6f89.js";const Da={class:"equipment-list-container"},wa={class:"card-header"},ka={class:"search-section"},ha={key:1},Ya={class:"pagination-section"},Ca={key:0,class:"equipment-detail"},Ea={__name:"EquipmentList",setup(Ma){const K=Fe(),_e=Te(),A=g(!1),z=g(!1),N=g(!1),Y=g(!1),$=g(!1),C=g(!1),E=g(!1),J=g([]),p=g(null),B=g([]),M=g(),P=g(),d=F({keyword:"",labId:"",status:"",purchaseDateRange:[]}),f=F({page:1,size:20,total:0}),o=F({id:null,name:"",model:"",serialNumber:"",labId:"",status:"available",purchaseDate:"",warrantyUntil:"",description:""}),r=F({equipmentId:null,type:"maintenance",description:"",cost:0,technician:"",startDate:w().format("YYYY-MM-DD"),expectedCompletionDate:"",status:"in_progress",remarks:""}),fe=ue(()=>_e.userInfo),be=ue(()=>E.value?"编辑设备":"新增设备"),ge={name:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],model:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:1,max:50,message:"型号长度在 1 到 50 个字符",trigger:"blur"}],serialNumber:[{required:!0,message:"请输入设备序列号",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],labId:[{required:!0,message:"请选择所属实验室",trigger:"change"}],status:[{required:!0,message:"请选择设备状态",trigger:"change"}],price:[{required:!0,message:"请输入设备价格",trigger:"blur"},{type:"number",min:0,message:"价格不能为负数",trigger:"blur"}],purchaseDate:[{required:!0,message:"请选择购买日期",trigger:"change"}]};ie(()=>{V(),W()}),Ae(()=>{V()});const ye={type:[{required:!0,message:"请选择维修类型",trigger:"change"}],description:[{required:!0,message:"请输入问题描述",trigger:"blur"},{min:10,max:500,message:"描述长度在 10 到 500 个字符",trigger:"blur"}]},Q=n=>n.includes(fe.value.user_type),W=async()=>{try{const n=await Va({page:1,page_size:100});n.code===200&&(B.value=n.data.list)}catch(n){console.error("加载实验室选项失败:",n)}},V=async()=>{A.value=!0;try{const n={page:f.page,page_size:f.size};d.keyword&&(n.search=d.keyword),d.labId&&(n.laboratory_id=d.labId),d.status&&(n.status=d.status==="normal"?"available":d.status==="broken"?"damaged":d.status==="scrapped"?"retired":d.status);const a=await _a(n);a.code===200&&(J.value=(a.data.list||[]).map(u=>{var _;return{id:u.id,name:u.name,model:u.model,lab_id:u.laboratory_id||void 0,lab_name:((_=u.laboratory)==null?void 0:_.name)||"",status:u.status==="available"?"normal":u.status==="damaged"?"broken":u.status==="retired"?"scrapped":u.status,price:u.price||0,purchase_date:u.purchase_date,warranty_until:u.warranty_until||u.warranty_date,supplier:u.supplier||"",description:u.description,maintenance_count:u.maintenance_count||0,created_at:u.created_at,updated_at:u.updated_at}}),f.total=a.data.total)}catch(n){console.error("加载设备列表失败:",n)}finally{A.value=!1}},G=()=>{f.page=1,V()},ve=()=>{d.keyword="",d.labId="",d.status="",d.purchaseDateRange=[],f.page=1,V()},Ve=n=>{f.size=n,f.page=1,V()},De=n=>{f.page=n,V()},we=()=>{E.value=!1,Z(),Y.value=!0},ke=async n=>{try{const a=await fa(n.id);a.code===200&&(p.value=a.data,$.value=!0)}catch(a){console.error("获取设备详情失败:",a)}},he=n=>{p.value=n,r.equipmentId=n.id,r.type="maintenance",r.description="",r.cost=0,r.technician="",r.startDate=w().format("YYYY-MM-DD"),r.expectedCompletionDate="",r.status="in_progress",r.remarks="",C.value=!0},Ye=n=>{K.push(`/equipment/maintenance?equipment_id=${n.id}`)},Ce=n=>{K.push(`/laboratory/list?id=${n}`)},Ee=()=>{T.info("导出功能开发中...")},Me=async()=>{if(M.value)try{await M.value.validate(),z.value=!0;const n={name:o.name,model:o.model,serial_number:o.serialNumber,laboratory_id:o.labId,status:o.status==="normal"?"available":o.status==="broken"?"damaged":o.status==="scrapped"?"retired":o.status,purchase_date:o.purchaseDate,warranty_date:o.warrantyUntil,description:o.description},a=E.value?ba:ga,u=E.value?[o.id,n]:[n];(await a(...u)).code===200&&(T.success(E.value?"更新成功":"创建成功"),Y.value=!1,V())}catch(n){console.error("提交失败:",n)}finally{z.value=!1}},xe=async()=>{if(P.value)try{await P.value.validate(),N.value=!0;const n={equipment_id:r.equipmentId,type:r.type,description:r.description,cost:r.cost,technician:r.technician,start_date:r.startDate,expected_completion_date:r.expectedCompletionDate,status:r.status,remarks:r.remarks};(await va(n)).code===200&&(T.success("维修记录创建成功"),C.value=!1,V())}catch(n){console.error("提交维修记录失败:",n)}finally{N.value=!1}},qe=async n=>{try{await Oe.confirm(`确定要删除设备 "${n.name}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"}),(await ya(n.id)).code===200&&(T.success("删除成功"),V())}catch(a){a!=="cancel"&&console.error("删除失败:",a)}},X=()=>{Y.value=!1,Z()},Z=()=>{o.id=null,o.name="",o.model="",o.serialNumber="",o.labId="",o.status="normal",o.purchaseDate="",o.warrantyUntil="",o.description="",M.value&&M.value.clearValidate()},ee=n=>w(n).format("YYYY-MM-DD HH:mm"),R=n=>w(n).isValid()?w(n).format("YYYY-MM-DD"):"-",ae=n=>Number(n).toLocaleString(),te=n=>w(n).isValid()?w(n).isBefore(w()):!1,le=n=>({normal:"success",maintenance:"warning",broken:"danger",scrapped:"info"})[n]||"info",ne=n=>({normal:"正常",maintenance:"维护中",broken:"故障",scrapped:"报废"})[n]||n;return ie(()=>{W(),V()}),(n,a)=>{const u=He,_=Ke,D=Je,x=Qe,m=We,q=Ge,S=Xe,Ue=Ze,y=ea,j=aa,oe=ta,Ie=la,ze=na,Ne=$e,c=oa,re=ra,se=sa,O=Be,b=ua,Re=ia,Se=da;return v(),U("div",Da,[e(Ne,null,{header:l(()=>[k("div",wa,[a[26]||(a[26]=k("span",null,"设备管理",-1)),Q(["admin","teacher"])?(v(),h(_,{key:0,type:"primary",onClick:we},{default:l(()=>[e(u,null,{default:l(()=>[e(I(pa))]),_:1}),a[25]||(a[25]=s(" 新增设备 ",-1))]),_:1})):H("",!0)])]),default:l(()=>[k("div",ka,[e(Ue,{gutter:20},{default:l(()=>[e(x,{span:5},{default:l(()=>[e(D,{modelValue:d.keyword,"onUpdate:modelValue":a[0]||(a[0]=t=>d.keyword=t),placeholder:"搜索设备名称或型号",clearable:"",onKeyup:Pe(G,["enter"])},{prefix:l(()=>[e(u,null,{default:l(()=>[e(I(ce))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(x,{span:4},{default:l(()=>[e(q,{modelValue:d.labId,"onUpdate:modelValue":a[1]||(a[1]=t=>d.labId=t),placeholder:"选择实验室",clearable:""},{default:l(()=>[e(m,{label:"全部实验室",value:""}),(v(!0),U(de,null,pe(B.value,t=>(v(),h(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(x,{span:4},{default:l(()=>[e(q,{modelValue:d.status,"onUpdate:modelValue":a[2]||(a[2]=t=>d.status=t),placeholder:"设备状态",clearable:""},{default:l(()=>[e(m,{label:"全部状态",value:""}),e(m,{label:"正常",value:"normal"}),e(m,{label:"维护中",value:"maintenance"}),e(m,{label:"故障",value:"broken"}),e(m,{label:"报废",value:"scrapped"})]),_:1},8,["modelValue"])]),_:1}),e(x,{span:4},{default:l(()=>[e(S,{modelValue:d.purchaseDateRange,"onUpdate:modelValue":a[3]||(a[3]=t=>d.purchaseDateRange=t),type:"daterange","range-separator":"至","start-placeholder":"购买开始日期","end-placeholder":"购买结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(x,{span:7},{default:l(()=>[e(_,{type:"primary",onClick:G},{default:l(()=>[e(u,null,{default:l(()=>[e(I(ce))]),_:1}),a[27]||(a[27]=s(" 搜索 ",-1))]),_:1}),e(_,{onClick:ve},{default:l(()=>[e(u,null,{default:l(()=>[e(I(ma))]),_:1}),a[28]||(a[28]=s(" 重置 ",-1))]),_:1}),e(_,{type:"success",onClick:Ee},{default:l(()=>[e(u,null,{default:l(()=>[e(I(ca))]),_:1}),a[29]||(a[29]=s(" 导出 ",-1))]),_:1})]),_:1})]),_:1})]),je((v(),h(Ie,{data:J.value,stripe:"",class:"equipment-table"},{default:l(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"id",label:"ID",width:"80"}),e(y,{prop:"name",label:"设备名称","min-width":"150"},{default:l(({row:t})=>[e(j,{type:"primary",onClick:L=>ke(t)},{default:l(()=>[s(i(t.name),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"model",label:"型号","min-width":"120"}),e(y,{prop:"lab_name",label:"所属实验室","min-width":"120"},{default:l(({row:t})=>[e(j,{type:"primary",onClick:L=>Ce(t.lab_id)},{default:l(()=>[s(i(t.lab_name),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"status",label:"状态",width:"100"},{default:l(({row:t})=>[e(oe,{type:le(t.status)},{default:l(()=>[s(i(ne(t.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"price",label:"价格",width:"100"},{default:l(({row:t})=>[s(" ¥"+i(ae(t.price)),1)]),_:1}),e(y,{prop:"purchase_date",label:"购买日期",width:"120"},{default:l(({row:t})=>[s(i(R(t.purchase_date)),1)]),_:1}),e(y,{prop:"warranty_until",label:"保修期至",width:"120"},{default:l(({row:t})=>[k("span",{class:me({"warranty-expired":te(t.warranty_until)})},i(R(t.warranty_until)),3)]),_:1}),e(y,{prop:"maintenance_count",label:"维修次数",width:"100"},{default:l(({row:t})=>[t.maintenance_count>0?(v(),h(j,{key:0,type:"primary",onClick:L=>Ye(t)},{default:l(()=>[s(i(t.maintenance_count)+"次 ",1)]),_:2},1032,["onClick"])):(v(),U("span",ha,"0次"))]),_:1}),Q(["admin","teacher"])?(v(),h(y,{key:0,label:"操作",width:"200",fixed:"right"},{default:l(({row:t})=>[e(_,{type:"warning",size:"small",onClick:L=>he(t)},{default:l(()=>[...a[30]||(a[30]=[s(" 维修 ",-1)])]),_:1},8,["onClick"]),e(_,{type:"danger",size:"small",onClick:L=>qe(t)},{default:l(()=>[...a[31]||(a[31]=[s(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})):H("",!0)]),_:1},8,["data"])),[[Se,A.value]]),k("div",Ya,[e(ze,{"current-page":f.page,"onUpdate:currentPage":a[4]||(a[4]=t=>f.page=t),"page-size":f.size,"onUpdate:pageSize":a[5]||(a[5]=t=>f.size=t),total:f.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ve,onCurrentChange:De},null,8,["current-page","page-size","total"])])]),_:1}),e(O,{modelValue:Y.value,"onUpdate:modelValue":a[16]||(a[16]=t=>Y.value=t),title:be.value,width:"600px","before-close":X},{footer:l(()=>[e(_,{onClick:X},{default:l(()=>[...a[32]||(a[32]=[s("取消",-1)])]),_:1}),e(_,{type:"primary",loading:z.value,onClick:Me},{default:l(()=>[s(i(z.value?"提交中...":"确定"),1)]),_:1},8,["loading"])]),default:l(()=>[e(se,{ref_key:"equipmentFormRef",ref:M,model:o,rules:ge,"label-width":"100px"},{default:l(()=>[e(c,{label:"设备名称",prop:"name"},{default:l(()=>[e(D,{modelValue:o.name,"onUpdate:modelValue":a[6]||(a[6]=t=>o.name=t),placeholder:"请输入设备名称",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"型号",prop:"model"},{default:l(()=>[e(D,{modelValue:o.model,"onUpdate:modelValue":a[7]||(a[7]=t=>o.model=t),placeholder:"请输入设备型号",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"序列号",prop:"serialNumber"},{default:l(()=>[e(D,{modelValue:o.serialNumber,"onUpdate:modelValue":a[8]||(a[8]=t=>o.serialNumber=t),placeholder:"请输入设备序列号",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"所属实验室",prop:"labId"},{default:l(()=>[e(q,{modelValue:o.labId,"onUpdate:modelValue":a[9]||(a[9]=t=>o.labId=t),style:{width:"100%"}},{default:l(()=>[(v(!0),U(de,null,pe(B.value,t=>(v(),h(m,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"状态",prop:"status"},{default:l(()=>[e(q,{modelValue:o.status,"onUpdate:modelValue":a[10]||(a[10]=t=>o.status=t),style:{width:"100%"}},{default:l(()=>[e(m,{label:"正常",value:"normal"}),e(m,{label:"维护中",value:"maintenance"}),e(m,{label:"故障",value:"broken"}),e(m,{label:"报废",value:"scrapped"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"价格",prop:"price"},{default:l(()=>[e(re,{modelValue:o.price,"onUpdate:modelValue":a[11]||(a[11]=t=>o.price=t),min:0,precision:2,placeholder:"请输入设备价格",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"购买日期",prop:"purchaseDate"},{default:l(()=>[e(S,{modelValue:o.purchaseDate,"onUpdate:modelValue":a[12]||(a[12]=t=>o.purchaseDate=t),type:"date",placeholder:"请选择购买日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"保修期至",prop:"warrantyUntil"},{default:l(()=>[e(S,{modelValue:o.warrantyUntil,"onUpdate:modelValue":a[13]||(a[13]=t=>o.warrantyUntil=t),type:"date",placeholder:"请选择保修期结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"供应商"},{default:l(()=>[e(D,{modelValue:o.supplier,"onUpdate:modelValue":a[14]||(a[14]=t=>o.supplier=t),placeholder:"请输入供应商名称（可选）",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"描述"},{default:l(()=>[e(D,{modelValue:o.description,"onUpdate:modelValue":a[15]||(a[15]=t=>o.description=t),type:"textarea",rows:4,placeholder:"请输入设备描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(O,{modelValue:$.value,"onUpdate:modelValue":a[17]||(a[17]=t=>$.value=t),title:"设备详情",width:"800px"},{default:l(()=>[p.value?(v(),U("div",Ca,[e(Re,{column:2,border:""},{default:l(()=>[e(b,{label:"ID"},{default:l(()=>[s(i(p.value.id),1)]),_:1}),e(b,{label:"名称"},{default:l(()=>[s(i(p.value.name),1)]),_:1}),e(b,{label:"型号"},{default:l(()=>[s(i(p.value.model),1)]),_:1}),e(b,{label:"所属实验室"},{default:l(()=>[s(i(p.value.lab_name),1)]),_:1}),e(b,{label:"状态"},{default:l(()=>[e(oe,{type:le(p.value.status)},{default:l(()=>[s(i(ne(p.value.status)),1)]),_:1},8,["type"])]),_:1}),e(b,{label:"价格"},{default:l(()=>[s(" ¥"+i(ae(p.value.price)),1)]),_:1}),e(b,{label:"购买日期"},{default:l(()=>[s(i(R(p.value.purchase_date)),1)]),_:1}),e(b,{label:"保修期至"},{default:l(()=>[k("span",{class:me({"warranty-expired":te(p.value.warranty_until)})},i(R(p.value.warranty_until)),3)]),_:1}),e(b,{label:"供应商"},{default:l(()=>[s(i(p.value.supplier||"无"),1)]),_:1}),e(b,{label:"维修次数"},{default:l(()=>[s(i(p.value.maintenance_count)+"次 ",1)]),_:1}),e(b,{label:"描述",span:2},{default:l(()=>[s(i(p.value.description||"无"),1)]),_:1}),e(b,{label:"创建时间"},{default:l(()=>[s(i(ee(p.value.created_at)),1)]),_:1}),e(b,{label:"更新时间"},{default:l(()=>[s(i(ee(p.value.updated_at)),1)]),_:1})]),_:1})])):H("",!0)]),_:1},8,["modelValue"]),e(O,{modelValue:C.value,"onUpdate:modelValue":a[24]||(a[24]=t=>C.value=t),title:"设备维修",width:"600px"},{footer:l(()=>[e(_,{onClick:a[23]||(a[23]=t=>C.value=!1)},{default:l(()=>[...a[33]||(a[33]=[s("取消",-1)])]),_:1}),e(_,{type:"primary",loading:N.value,onClick:xe},{default:l(()=>[s(i(N.value?"提交中...":"提交维修"),1)]),_:1},8,["loading"])]),default:l(()=>[e(se,{ref_key:"maintenanceFormRef",ref:P,model:r,rules:ye,"label-width":"100px"},{default:l(()=>[e(c,{label:"维修类型",prop:"type"},{default:l(()=>[e(q,{modelValue:r.type,"onUpdate:modelValue":a[18]||(a[18]=t=>r.type=t),style:{width:"100%"}},{default:l(()=>[e(m,{label:"定期保养",value:"maintenance"}),e(m,{label:"故障维修",value:"repair"}),e(m,{label:"升级改造",value:"upgrade"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"问题描述",prop:"description"},{default:l(()=>[e(D,{modelValue:r.description,"onUpdate:modelValue":a[19]||(a[19]=t=>r.description=t),type:"textarea",rows:4,placeholder:"请描述设备问题或维修内容"},null,8,["modelValue"])]),_:1}),e(c,{label:"维修费用"},{default:l(()=>[e(re,{modelValue:r.cost,"onUpdate:modelValue":a[20]||(a[20]=t=>r.cost=t),min:0,precision:2,placeholder:"请输入维修费用",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"维修人员"},{default:l(()=>[e(D,{modelValue:r.technician,"onUpdate:modelValue":a[21]||(a[21]=t=>r.technician=t),placeholder:"请输入维修人员姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"预计完成时间"},{default:l(()=>[e(S,{modelValue:r.expectedCompletionDate,"onUpdate:modelValue":a[22]||(a[22]=t=>r.expectedCompletionDate=t),type:"date",placeholder:"请选择预计完成时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Xa=Le(Ea,[["__scopeId","data-v-582436b8"]]);export{Xa as default};
