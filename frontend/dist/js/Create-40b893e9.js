import{_ as q}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                *//* empty css                 *//* empty css                  *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                       */import{u as D,r as i,b as I,H as L,o as z,c as d,d as y,f as o,w as s,a5 as M,e as x,j as m,z as n,F as h,y as P,A as p,N as O,k as _,B as Y,l as G,m as H,C as $,D as J,n as K,p as Q,E as W,h as X}from"./index-0407e335.js";import{getCoursesApi as Z}from"./course-750d183b.js";const ee={class:"user-create"},re={__name:"Create",setup(ae){const V=D(),f=i(),g=i(!1),v=i([]),c=i(!1),r=I({user_name:"",email:"",password:"",confirmPassword:"",user_type:"Student",course_id:null,major:"",grade:"",department:""}),j=new Date().getFullYear(),U=Array.from({length:6},(a,e)=>j-e),k={user_name:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 50 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱",trigger:"blur"},{type:"email",message:"邮箱格式不正确",trigger:["blur","change"]}],password:[{validator:(a,e,l)=>{e===""?l(new Error("请输入密码")):e.length<6?l(new Error("密码长度不能少于6位")):(r.confirmPassword!==""&&f.value.validateField("confirmPassword"),l())},trigger:"blur"}],confirmPassword:[{validator:(a,e,l)=>{e===""?l(new Error("请再次输入密码")):e!==r.password?l(new Error("两次输入密码不一致")):l()},trigger:"blur"}],user_type:[{required:!0,message:"请选择用户类型",trigger:"change"}],course_id:[{validator:(a,e,l)=>{r.user_type==="Student"&&!e?l(new Error("学生必须选择所属课程")):l()},trigger:"change"}],major:[{validator:(a,e,l)=>{r.user_type==="Student"&&!e?l(new Error("请输入专业")):l()},trigger:"blur"}],grade:[{validator:(a,e,l)=>{r.user_type==="Student"&&!e?l(new Error("请选择年级")):l()},trigger:"change"}],department:[{validator:(a,e,l)=>{r.user_type==="Teacher"&&!e?l(new Error("请输入所属院系")):l()},trigger:"blur"}]};L(()=>r.user_type,a=>{a!=="Student"&&(r.course_id=null,r.major="",r.grade=""),a!=="Teacher"&&(r.department=""),a==="Student"&&!c.value&&b()});const b=async()=>{try{const a=await Z({page:1,page_size:100});a.code===200?(v.value=(a.data.list||[]).map(e=>({course_id:e.id,course_name:e.name})),c.value=!0):_.error(a.message||"加载课程列表失败")}catch{_.error("加载课程列表失败")}},B=a=>{a&&r.user_type==="Student"&&!c.value&&b()},F=async()=>{try{await f.value.validate(),g.value=!0;const a={username:r.user_name,name:r.user_name,real_name:r.user_name,email:r.email,password:r.password,role:(r.user_type||"").toLowerCase()};r.user_type==="Student"?(a.course_id=r.course_id,a.major=r.major,a.grade=r.grade):r.user_type==="Teacher"&&(a.department=r.department),(await Y(a)).code===200&&(_.success("用户创建成功"),V.push("/user/list"))}catch(a){const e=(a==null?void 0:a.message)||"创建失败，请重试";_.error(e)}finally{g.value=!1}},T=()=>{V.back()};return z(()=>{}),(a,e)=>{const l=G,u=H,w=$,A=J,E=K,C=Q,S=W,N=X,R=M;return d(),y("div",ee,[o(R,null,{header:s(()=>[...e[9]||(e[9]=[x("div",{class:"card-header"},[x("span",null,"新增用户")],-1)])]),default:s(()=>[o(N,{ref_key:"formRef",ref:f,model:r,rules:k,"label-width":"120px",class:"user-form"},{default:s(()=>[o(u,{label:"用户名",prop:"user_name"},{default:s(()=>[o(l,{modelValue:r.user_name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.user_name=t),placeholder:"请输入用户名",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(u,{label:"邮箱",prop:"email"},{default:s(()=>[o(l,{modelValue:r.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.email=t),placeholder:"请输入邮箱",maxlength:"100",clearable:""},null,8,["modelValue"])]),_:1}),o(u,{label:"密码",prop:"password"},{default:s(()=>[o(l,{modelValue:r.password,"onUpdate:modelValue":e[2]||(e[2]=t=>r.password=t),type:"password",placeholder:"请输入密码","show-password":"",maxlength:"50"},null,8,["modelValue"])]),_:1}),o(u,{label:"确认密码",prop:"confirmPassword"},{default:s(()=>[o(l,{modelValue:r.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=t=>r.confirmPassword=t),type:"password",placeholder:"请再次输入密码","show-password":"",maxlength:"50"},null,8,["modelValue"])]),_:1}),o(u,{label:"用户类型",prop:"user_type"},{default:s(()=>[o(A,{modelValue:r.user_type,"onUpdate:modelValue":e[4]||(e[4]=t=>r.user_type=t)},{default:s(()=>[o(w,{label:"Student"},{default:s(()=>[...e[10]||(e[10]=[m("学生",-1)])]),_:1}),o(w,{label:"Teacher"},{default:s(()=>[...e[11]||(e[11]=[m("教师",-1)])]),_:1}),o(w,{label:"Admin"},{default:s(()=>[...e[12]||(e[12]=[m("管理员",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),r.user_type==="Student"?(d(),n(u,{key:0,label:"所属课程",prop:"course_id"},{default:s(()=>[o(C,{modelValue:r.course_id,"onUpdate:modelValue":e[5]||(e[5]=t=>r.course_id=t),placeholder:"请选择课程",filterable:"",onVisibleChange:B},{default:s(()=>[(d(!0),y(h,null,P(v.value,t=>(d(),n(E,{key:t.course_id,label:t.course_name,value:t.course_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):p("",!0),r.user_type==="Student"?(d(),n(u,{key:1,label:"专业",prop:"major"},{default:s(()=>[o(l,{modelValue:r.major,"onUpdate:modelValue":e[6]||(e[6]=t=>r.major=t),placeholder:"请输入专业",maxlength:"100"},null,8,["modelValue"])]),_:1})):p("",!0),r.user_type==="Student"?(d(),n(u,{key:2,label:"年级",prop:"grade"},{default:s(()=>[o(C,{modelValue:r.grade,"onUpdate:modelValue":e[7]||(e[7]=t=>r.grade=t),placeholder:"请选择年级"},{default:s(()=>[(d(!0),y(h,null,P(O(U),t=>(d(),n(E,{key:t,label:`${t}级`,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):p("",!0),r.user_type==="Teacher"?(d(),n(u,{key:3,label:"所属院系",prop:"department"},{default:s(()=>[o(l,{modelValue:r.department,"onUpdate:modelValue":e[8]||(e[8]=t=>r.department=t),placeholder:"请输入所属院系",maxlength:"100"},null,8,["modelValue"])]),_:1})):p("",!0),o(u,null,{default:s(()=>[o(S,{type:"primary",onClick:F,loading:g.value},{default:s(()=>[...e[13]||(e[13]=[m(" 创建 ",-1)])]),_:1},8,["loading"]),o(S,{onClick:T},{default:s(()=>[...e[14]||(e[14]=[m("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ge=q(re,[["__scopeId","data-v-773317c1"]]);export{ge as default};
