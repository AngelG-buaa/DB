import{_ as De}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                             *//* empty css                 *//* empty css                  *//* empty css                  *//* empty css                             *//* empty css                  *//* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                *//* empty css               *//* empty css                        */import{u as ze,a as Me,r as _,b as q,J as ae,v as te,o as qe,ah as Le,c,d as v,f as e,w as t,a5 as Ue,x as Ye,e as f,z as R,N as L,j as n,A as C,g as Se,ai as Ie,t as s,F as Te,y as Ae,O as Fe,k as le,P as $e,Q as Be,E as Re,l as Ne,a7 as Pe,n as je,p as He,aj as Ke,a6 as Oe,ak as Je,s as Qe,a8 as Ge,al as We,am as Xe,m as Ze,h as ea,an as aa,ao as ta,ap as la,aq as oa,ae as na,ar as oe,as as sa}from"./index-0407e335.js";import{getLabsApi as ia,getLabByIdApi as ua,getLabAvailabilityApi as ra,createLabApi as da,deleteLabApi as pa}from"./lab-ae8b6f89.js";const ma={class:"lab-list-container"},ca={class:"card-header"},_a={class:"search-section"},fa={class:"pagination-section"},ba={key:0,class:"lab-detail"},va={key:0,class:"equipment-section"},ga={key:0},ya={key:0,class:"availability-timeline"},Va={class:"timeline"},Ca={class:"time"},ha={class:"status"},ka={key:0,class:"reservation-info"},wa={__name:"LabList",setup(xa){const N=ze(),ne=Me(),U=_(!1),D=_(!1),k=_(!1),Y=_(!1),S=_(!1),P=_(!1),j=_([]),i=_(null),I=_([]),w=_(),r=q({keyword:"",status:"",minCapacity:null,maxCapacity:null}),p=q({page:1,size:20,total:0}),u=q({id:null,name:"",location:"",capacity:1,manager:"",status:"available",description:""}),h=q({date:ae().format("YYYY-MM-DD")}),se=te(()=>ne.userInfo),ie=te(()=>"新建实验室"),ue={name:[{required:!0,message:"请输入实验室名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],location:[{required:!0,message:"请输入实验室位置",trigger:"blur"},{min:2,max:100,message:"位置长度在 2 到 100 个字符",trigger:"blur"}],capacity:[{required:!0,message:"请输入容量",trigger:"blur"},{type:"number",min:1,max:1e3,message:"容量必须在 1 到 1000 之间",trigger:"blur"}],manager:[{required:!0,message:"请输入负责人姓名",trigger:"blur"},{min:2,max:20,message:"负责人姓名长度在 2 到 20 个字符",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},H=o=>o.includes(se.value.user_type),b=async()=>{U.value=!0;try{const o={page:p.page,page_size:p.size};r.keyword&&(o.search=r.keyword),r.status&&(o.status=r.status),r.minCapacity&&(o.min_capacity=r.minCapacity),r.maxCapacity&&(o.max_capacity=r.maxCapacity);const a=await ia(o);a.code===200&&(j.value=a.data.list,p.total=a.data.total)}catch(o){console.error("加载实验室列表失败:",o)}finally{U.value=!1}},K=()=>{p.page=1,b()},re=()=>{r.keyword="",r.status="",r.minCapacity=null,r.maxCapacity=null,p.page=1,b()},de=o=>{p.size=o,p.page=1,b()},pe=o=>{p.page=o,b()},me=()=>{P.value=!1,Q(),k.value=!0},ce=async o=>{try{const a=await ua(o.id);a.code===200&&(i.value=a.data,Y.value=!0)}catch(a){console.error("获取实验室详情失败:",a)}},_e=o=>{N.push(`/equipment?lab_id=${o.id}`)},fe=o=>{N.push(`/reservation/list?lab_id=${o.id}`)},be=async o=>{i.value=o,S.value=!0,await O()},O=async()=>{if(!(!i.value||!h.date))try{const o=await ra(i.value.id,{date:h.date});o.code===200&&(I.value=o.data)}catch(o){console.error("获取可用性数据失败:",o)}},ve=async()=>{if(w.value)try{await w.value.validate(),D.value=!0,(await da(u)).code===200&&(le.success(P.value?"更新成功":"创建成功"),k.value=!1,b())}catch(o){console.error("提交失败:",o)}finally{D.value=!1}},ge=async o=>{try{await $e.confirm(`确定要删除实验室 "${o.name}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"}),(await pa(o.id)).code===200&&(le.success("删除成功"),b())}catch(a){a!=="cancel"&&console.error("删除失败:",a)}},J=()=>{k.value=!1,Q()},Q=()=>{u.id=null,u.name="",u.location="",u.capacity=1,u.manager="",u.status="available",u.description="",w.value&&w.value.clearValidate()},T=o=>ae(o).format("YYYY-MM-DD HH:mm"),G=o=>({available:"success",maintenance:"warning",occupied:"danger"})[o]||"info",W=o=>({available:"可用",maintenance:"维护中",occupied:"停用"})[o]||o,ye=o=>({normal:"success",maintenance:"warning",broken:"danger"})[o]||"info",Ve=o=>({normal:"正常",maintenance:"维护中",broken:"故障"})[o]||o;return qe(()=>{b()}),Le(()=>{b()}),(o,a)=>{const z=Be,g=Re,x=Ne,E=Pe,y=je,X=He,A=Ke,Ce=Oe,d=Je,F=Qe,$=Ge,Z=We,he=Xe,ke=Ue,V=Ze,ee=ea,B=Ye,m=aa,we=ta,xe=la,Ee=oa;return c(),v("div",ma,[e(ke,null,{header:t(()=>[f("div",ca,[a[17]||(a[17]=f("span",null,"实验室管理",-1)),H(["admin","teacher"])?(c(),R(g,{key:0,type:"primary",onClick:me},{default:t(()=>[e(z,null,{default:t(()=>[e(L(na))]),_:1}),a[16]||(a[16]=n(" 新建实验室 ",-1))]),_:1})):C("",!0)])]),default:t(()=>[f("div",_a,[e(Ce,{gutter:20},{default:t(()=>[e(E,{span:6},{default:t(()=>[e(x,{modelValue:r.keyword,"onUpdate:modelValue":a[0]||(a[0]=l=>r.keyword=l),placeholder:"搜索实验室名称或位置",clearable:"",onKeyup:Se(K,["enter"])},{prefix:t(()=>[e(z,null,{default:t(()=>[e(L(oe))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(E,{span:4},{default:t(()=>[e(X,{modelValue:r.status,"onUpdate:modelValue":a[1]||(a[1]=l=>r.status=l),placeholder:"状态",clearable:""},{default:t(()=>[e(y,{label:"全部",value:""}),e(y,{label:"可用",value:"available"}),e(y,{label:"维护中",value:"maintenance"}),e(y,{label:"停用",value:"occupied"})]),_:1},8,["modelValue"])]),_:1}),e(E,{span:4},{default:t(()=>[e(A,{modelValue:r.minCapacity,"onUpdate:modelValue":a[2]||(a[2]=l=>r.minCapacity=l),placeholder:"最小容量",min:1,max:1e3,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(E,{span:4},{default:t(()=>[e(A,{modelValue:r.maxCapacity,"onUpdate:modelValue":a[3]||(a[3]=l=>r.maxCapacity=l),placeholder:"最大容量",min:1,max:1e3,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(E,{span:6},{default:t(()=>[e(g,{type:"primary",onClick:K},{default:t(()=>[e(z,null,{default:t(()=>[e(L(oe))]),_:1}),a[18]||(a[18]=n(" 搜索 ",-1))]),_:1}),e(g,{onClick:re},{default:t(()=>[e(z,null,{default:t(()=>[e(L(sa))]),_:1}),a[19]||(a[19]=n(" 重置 ",-1))]),_:1})]),_:1})]),_:1})]),Ie((c(),R(Z,{data:j.value,stripe:"",class:"lab-table"},{default:t(()=>[e(d,{prop:"id",label:"ID",width:"80"}),e(d,{prop:"name",label:"实验室名称","min-width":"150"},{default:t(({row:l})=>[e(F,{type:"primary",onClick:M=>ce(l)},{default:t(()=>[n(s(l.name),1)]),_:2},1032,["onClick"])]),_:1}),e(d,{prop:"location",label:"位置","min-width":"120"}),e(d,{prop:"capacity",label:"容量",width:"80"},{default:t(({row:l})=>[n(s(l.capacity)+"人 ",1)]),_:1}),e(d,{prop:"manager",label:"负责人",width:"100"}),e(d,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e($,{type:G(l.status)},{default:t(()=>[n(s(W(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"equipment_count",label:"设备数量",width:"100"},{default:t(({row:l})=>[e(F,{type:"primary",onClick:M=>_e(l)},{default:t(()=>[n(s(l.equipment_count)+"台 ",1)]),_:2},1032,["onClick"])]),_:1}),e(d,{prop:"reservation_count",label:"预约数",width:"100"},{default:t(({row:l})=>[e(F,{type:"primary",onClick:M=>fe(l)},{default:t(()=>[n(s(l.reservation_count),1)]),_:2},1032,["onClick"])]),_:1}),e(d,{prop:"created_at",label:"创建时间",width:"160"},{default:t(({row:l})=>[n(s(T(l.created_at)),1)]),_:1}),H(["admin","teacher"])?(c(),R(d,{key:0,label:"操作",width:"160",fixed:"right"},{default:t(({row:l})=>[e(g,{type:"success",size:"small",onClick:M=>be(l)},{default:t(()=>[...a[20]||(a[20]=[n(" 可用性 ",-1)])]),_:1},8,["onClick"]),e(g,{type:"danger",size:"small",onClick:M=>ge(l)},{default:t(()=>[...a[21]||(a[21]=[n(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})):C("",!0)]),_:1},8,["data"])),[[Ee,U.value]]),f("div",fa,[e(he,{"current-page":p.page,"onUpdate:currentPage":a[4]||(a[4]=l=>p.page=l),"page-size":p.size,"onUpdate:pageSize":a[5]||(a[5]=l=>p.size=l),total:p.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:de,onCurrentChange:pe},null,8,["current-page","page-size","total"])])]),_:1}),e(B,{modelValue:k.value,"onUpdate:modelValue":a[12]||(a[12]=l=>k.value=l),title:ie.value,width:"600px","before-close":J},{footer:t(()=>[e(g,{onClick:J},{default:t(()=>[...a[22]||(a[22]=[n("取消",-1)])]),_:1}),e(g,{type:"primary",loading:D.value,onClick:ve},{default:t(()=>[n(s(D.value?"提交中...":"确定"),1)]),_:1},8,["loading"])]),default:t(()=>[e(ee,{ref_key:"labFormRef",ref:w,model:u,rules:ue,"label-width":"100px"},{default:t(()=>[e(V,{label:"实验室名称",prop:"name"},{default:t(()=>[e(x,{modelValue:u.name,"onUpdate:modelValue":a[6]||(a[6]=l=>u.name=l),placeholder:"请输入实验室名称",clearable:""},null,8,["modelValue"])]),_:1}),e(V,{label:"位置",prop:"location"},{default:t(()=>[e(x,{modelValue:u.location,"onUpdate:modelValue":a[7]||(a[7]=l=>u.location=l),placeholder:"请输入实验室位置",clearable:""},null,8,["modelValue"])]),_:1}),e(V,{label:"容量",prop:"capacity"},{default:t(()=>[e(A,{modelValue:u.capacity,"onUpdate:modelValue":a[8]||(a[8]=l=>u.capacity=l),min:1,max:1e3,placeholder:"请输入容量",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(V,{label:"负责人",prop:"manager"},{default:t(()=>[e(x,{modelValue:u.manager,"onUpdate:modelValue":a[9]||(a[9]=l=>u.manager=l),placeholder:"请输入负责人姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(V,{label:"状态",prop:"status"},{default:t(()=>[e(X,{modelValue:u.status,"onUpdate:modelValue":a[10]||(a[10]=l=>u.status=l),style:{width:"100%"}},{default:t(()=>[e(y,{label:"可用",value:"available"}),e(y,{label:"维护中",value:"maintenance"}),e(y,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"描述"},{default:t(()=>[e(x,{modelValue:u.description,"onUpdate:modelValue":a[11]||(a[11]=l=>u.description=l),type:"textarea",rows:4,placeholder:"请输入实验室描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(B,{modelValue:Y.value,"onUpdate:modelValue":a[13]||(a[13]=l=>Y.value=l),title:"实验室详情",width:"800px"},{default:t(()=>[i.value?(c(),v("div",ba,[e(we,{column:2,border:""},{default:t(()=>[e(m,{label:"ID"},{default:t(()=>[n(s(i.value.id),1)]),_:1}),e(m,{label:"名称"},{default:t(()=>[n(s(i.value.name),1)]),_:1}),e(m,{label:"位置"},{default:t(()=>[n(s(i.value.location),1)]),_:1}),e(m,{label:"容量"},{default:t(()=>[n(s(i.value.capacity)+"人 ",1)]),_:1}),e(m,{label:"负责人"},{default:t(()=>[n(s(i.value.manager),1)]),_:1}),e(m,{label:"状态"},{default:t(()=>[e($,{type:G(i.value.status)},{default:t(()=>[n(s(W(i.value.status)),1)]),_:1},8,["type"])]),_:1}),e(m,{label:"设备数量"},{default:t(()=>[n(s(i.value.equipment_count)+"台 ",1)]),_:1}),e(m,{label:"预约数量"},{default:t(()=>[n(s(i.value.reservation_count),1)]),_:1}),e(m,{label:"描述",span:2},{default:t(()=>[n(s(i.value.description||"无"),1)]),_:1}),e(m,{label:"创建时间"},{default:t(()=>[n(s(T(i.value.created_at)),1)]),_:1}),e(m,{label:"更新时间"},{default:t(()=>[n(s(T(i.value.updated_at)),1)]),_:1})]),_:1}),i.value.equipment&&i.value.equipment.length>0?(c(),v("div",va,[a[23]||(a[23]=f("h4",null,"实验室设备",-1)),e(Z,{data:i.value.equipment,size:"small"},{default:t(()=>[e(d,{prop:"name",label:"设备名称"}),e(d,{prop:"model",label:"型号"}),e(d,{prop:"status",label:"状态"},{default:t(({row:l})=>[e($,{type:ye(l.status),size:"small"},{default:t(()=>[n(s(Ve(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"purchase_date",label:"购买日期"})]),_:1},8,["data"])])):C("",!0)])):C("",!0)]),_:1},8,["modelValue"]),e(B,{modelValue:S.value,"onUpdate:modelValue":a[15]||(a[15]=l=>S.value=l),title:"实验室可用性",width:"600px"},{default:t(()=>[i.value?(c(),v("div",ga,[e(ee,{model:h,"label-width":"100px"},{default:t(()=>[e(V,{label:"查询日期"},{default:t(()=>[e(xe,{modelValue:h.date,"onUpdate:modelValue":a[14]||(a[14]=l=>h.date=l),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:O},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),I.value.length>0?(c(),v("div",ya,[f("h4",null,s(h.date)+" 可用性时间线",1),f("div",Va,[(c(!0),v(Te,null,Ae(I.value,l=>(c(),v("div",{key:l.time,class:Fe(["time-slot",l.available?"available":"occupied"])},[f("span",Ca,s(l.time),1),f("span",ha,s(l.available?"可用":"已预约"),1),l.available?C("",!0):(c(),v("span",ka,s(l.reservation_info),1))],2))),128))])])):C("",!0)])):C("",!0)]),_:1},8,["modelValue"])])}}},Oa=De(wa,[["__scopeId","data-v-09b9bdb8"]]);export{Oa as default};
