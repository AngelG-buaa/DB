import{_ as Y}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                *//* empty css                 *//* empty css                  *//* empty css                        *//* empty css                             *//* empty css                  *//* empty css               *//* empty css                  */import{u as M,r as i,b as B,o as D,c as p,d as q,f as l,w as r,k as _,a5 as F,e as d,F as I,y as N,z as L,j as v,l as R,m as j,n as z,p as A,ap as S,aj as O,E as P,h as T}from"./index-0407e335.js";import{getLabsApi as G}from"./lab-ae8b6f89.js";import{c as H}from"./equipment-16832688.js";const J={class:"equipment-create"},K={__name:"Create",setup(Q){const b=M(),g=i(),m=i(!1),c=i([]),a=B({equip_name:"",model:"",serial_number:"",lab_id:null,buy_date:"",price:0,equip_status:"正常",warn_threshold:10}),w={equip_name:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],model:[{required:!0,message:"请输入设备型号",trigger:"blur"},{max:50,message:"长度不能超过 50 个字符",trigger:"blur"}],serial_number:[{required:!0,message:"请输入设备序列号",trigger:"blur"}],lab_id:[{required:!0,message:"请选择实验室",trigger:"change"}],buy_date:[{required:!0,message:"请选择购买日期",trigger:"change"}],price:[{required:!0,message:"请输入价格",trigger:"blur"},{type:"number",min:0,message:"价格不能为负数",trigger:"blur"}],equip_status:[{required:!0,message:"请选择设备状态",trigger:"change"}],warn_threshold:[{type:"number",min:0,max:100,message:"警告阈值必须在0-100之间",trigger:"blur"}]},x=async()=>{try{const s=await G({page:1,page_size:200});s.code===200&&(c.value=(s.data.list||[]).map(e=>({lab_id:e.id,lab_name:e.name})))}catch{_.error("加载实验室列表失败")}},h=async()=>{try{await g.value.validate(),m.value=!0;const s={正常:"available",维修中:"maintenance",报废:"retired"},e={name:a.equip_name,model:a.model,serial_number:a.serial_number,laboratory_id:a.lab_id,status:s[a.equip_status],purchase_date:a.buy_date,description:""};(await H(e)).code===200&&(_.success("设备创建成功"),b.push("/equipment/list"))}catch(s){s!==!1&&_.error("创建失败，请重试")}finally{m.value=!1}},E=()=>{b.back()};return D(()=>{x()}),(s,e)=>{const u=R,o=j,n=z,f=A,k=S,y=O,V=P,C=T,U=F;return p(),q("div",J,[l(U,null,{header:r(()=>[...e[8]||(e[8]=[d("div",{class:"card-header"},[d("span",null,"新增设备")],-1)])]),default:r(()=>[l(C,{ref_key:"formRef",ref:g,model:a,rules:w,"label-width":"120px",class:"equipment-form"},{default:r(()=>[l(o,{label:"设备名称",prop:"equip_name"},{default:r(()=>[l(u,{modelValue:a.equip_name,"onUpdate:modelValue":e[0]||(e[0]=t=>a.equip_name=t),placeholder:"请输入设备名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(o,{label:"型号",prop:"model"},{default:r(()=>[l(u,{modelValue:a.model,"onUpdate:modelValue":e[1]||(e[1]=t=>a.model=t),placeholder:"请输入设备型号",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(o,{label:"序列号",prop:"serial_number"},{default:r(()=>[l(u,{modelValue:a.serial_number,"onUpdate:modelValue":e[2]||(e[2]=t=>a.serial_number=t),placeholder:"请输入设备序列号",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(o,{label:"所属实验室",prop:"lab_id"},{default:r(()=>[l(f,{modelValue:a.lab_id,"onUpdate:modelValue":e[3]||(e[3]=t=>a.lab_id=t),placeholder:"请选择实验室",filterable:""},{default:r(()=>[(p(!0),q(I,null,N(c.value,t=>(p(),L(n,{key:t.lab_id,label:t.lab_name,value:t.lab_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(o,{label:"购买日期",prop:"buy_date"},{default:r(()=>[l(k,{modelValue:a.buy_date,"onUpdate:modelValue":e[4]||(e[4]=t=>a.buy_date=t),type:"date",placeholder:"请选择购买日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(o,{label:"价格",prop:"price"},{default:r(()=>[l(y,{modelValue:a.price,"onUpdate:modelValue":e[5]||(e[5]=t=>a.price=t),min:0,precision:2,placeholder:"请输入价格",style:{width:"200px"}},null,8,["modelValue"]),e[9]||(e[9]=d("span",{style:{"margin-left":"10px"}},"元",-1))]),_:1}),l(o,{label:"设备状态",prop:"equip_status"},{default:r(()=>[l(f,{modelValue:a.equip_status,"onUpdate:modelValue":e[6]||(e[6]=t=>a.equip_status=t),placeholder:"请选择状态"},{default:r(()=>[l(n,{label:"正常",value:"正常"}),l(n,{label:"维修中",value:"维修中"}),l(n,{label:"报废",value:"报废"})]),_:1},8,["modelValue"])]),_:1}),l(o,{label:"警告阈值",prop:"warn_threshold"},{default:r(()=>[l(y,{modelValue:a.warn_threshold,"onUpdate:modelValue":e[7]||(e[7]=t=>a.warn_threshold=t),min:0,max:100,placeholder:"请输入警告阈值",style:{width:"200px"}},null,8,["modelValue"]),e[10]||(e[10]=d("span",{style:{"margin-left":"10px"}},"%",-1))]),_:1}),l(o,null,{default:r(()=>[l(V,{type:"primary",onClick:h,loading:m.value},{default:r(()=>[...e[11]||(e[11]=[v(" 创建 ",-1)])]),_:1},8,["loading"]),l(V,{onClick:E},{default:r(()=>[...e[12]||(e[12]=[v("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},ne=Y(K,[["__scopeId","data-v-78c5163e"]]);export{ne as default};
