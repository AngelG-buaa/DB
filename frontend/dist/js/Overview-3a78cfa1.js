import{_ as M}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                         *//* empty css               *//* empty css                */import{r as _,b as P,o as R,a4 as S,c as y,d as F,f as e,w as t,a5 as V,a6 as j,e as s,N as f,t as m,F as q,y as Q,z as $,j as G,Q as H,a7 as J,av as K,aw as W,aL as X,af as Y,a9 as Z,aa as tt}from"./index-0407e335.js";import{i as v}from"./index-18acf776.js";import{getReservationStatsApi as at}from"./reservation-e2a96893.js";import{b as et}from"./equipment-16832688.js";import{g as U}from"./maintenance-0ef2aad3.js";import{getLabsApi as st}from"./lab-ae8b6f89.js";import{getUsersApi as ot}from"./user-08aa0f2d.js";const nt={class:"statistics-overview"},it={class:"stat-content"},lt={class:"stat-icon lab-icon"},rt={class:"stat-info"},ct={class:"stat-number"},dt={class:"stat-content"},ut={class:"stat-icon equipment-icon"},_t={class:"stat-info"},pt={class:"stat-number"},mt={class:"stat-content"},ft={class:"stat-icon user-icon"},vt={class:"stat-info"},yt={class:"stat-number"},ht={class:"stat-content"},gt={class:"stat-icon reservation-icon"},bt={class:"stat-info"},Ct={class:"stat-number"},xt={__name:"Overview",setup(wt){const h=_(),g=_(),b=_(),C=_(),p=P({totalLabs:0,totalEquipment:0,totalUsers:0,totalReservations:0}),x=_([]),w=_([]),L=async()=>{var n,a,i,o,l;try{const[r,c,k,d,u]=await Promise.all([at({}),et(),U({}),st({page:1,page_size:1}),ot({page:1,page_size:1e3})]),B=r.code===200&&r.data.total_reservations||0;Object.assign(p,{totalLabs:d.code===200&&((n=d==null?void 0:d.data)==null?void 0:n.total)||0,totalEquipment:c.code===200&&(((a=c==null?void 0:c.data)==null?void 0:a.total)||((i=c==null?void 0:c.data)==null?void 0:i.count))||0,totalUsers:u.code===200&&((o=u==null?void 0:u.data)==null?void 0:o.total)||0,totalReservations:B});const D=r.code===200?r.data.daily_trend||r.data.by_date||[]:[],N=r.code===200?r.data.laboratory_distribution||r.data.by_laboratory||[]:[],z=c.code===200?c.data||{}:{};w.value=u.code===200?((l=u==null?void 0:u.data)==null?void 0:l.list)||[]:[],S(()=>{E(D),A(N),T(z),O(w.value)})}catch(r){console.error("加载统计数据失败:",r)}},I=async()=>{try{const n=await U({});x.value=n.code===200?[{id:1,content:`本月维修 ${n.data.thisMonth} 条`,timestamp:new Date().toISOString().slice(0,16).replace("T"," "),type:"warning"}]:[]}catch(n){console.error("加载最近活动失败:",n)}},E=n=>{const a=v(h.value),i={tooltip:{trigger:"axis"},xAxis:{type:"category",data:(n||[]).map(o=>o.date)},yAxis:{type:"value"},series:[{data:(n||[]).map(o=>o.count),type:"line",smooth:!0,itemStyle:{color:"#409EFF"}}]};a.setOption(i)},A=n=>{const a=v(g.value),i={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c}% ({d}%)"},series:[{name:"使用率",type:"pie",radius:["40%","70%"],data:(n||[]).map(o=>({value:o.reservation_count||o.count,name:o.laboratory_name})),itemStyle:{color:function(o){return["#67C23A","#E6A23C","#F56C6C"][o.dataIndex]}}}]};a.setOption(i)},T=n=>{const a=v(b.value),i={tooltip:{trigger:"item"},series:[{type:"pie",radius:"60%",data:[{value:n.available||0,name:"可用"},{value:n.in_use||0,name:"使用中"},{value:n.maintenance||0,name:"维护中"},{value:n.damaged||0,name:"故障"},{value:n.retired||0,name:"退役"}],itemStyle:{color:function(o){return["#67C23A","#E6A23C","#F56C6C"][o.dataIndex]}}}]};a.setOption(i)},O=n=>{const a=v(C.value),i={student:0,teacher:0,admin:0};for(const l of n||[])l.role&&i.hasOwnProperty(l.role)&&(i[l.role]+=1);const o={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:["学生","教师","管理员"]},yAxis:{type:"value"},series:[{data:[i.student,i.teacher,i.admin],type:"bar",itemStyle:{color:"#409EFF"}}]};a.setOption(o)};return R(async()=>{await L(),await I(),S(()=>{E(),A(),T(),O()})}),(n,a)=>{const i=H,o=V,l=J,r=j,c=K,k=W;return y(),F("div",nt,[e(r,{gutter:20,class:"stats-cards"},{default:t(()=>[e(l,{span:6},{default:t(()=>[e(o,{class:"stat-card"},{default:t(()=>[s("div",it,[s("div",lt,[e(i,null,{default:t(()=>[e(f(X))]),_:1})]),s("div",rt,[s("div",ct,m(p.totalLabs),1),a[0]||(a[0]=s("div",{class:"stat-label"},"实验室总数",-1))])])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(o,{class:"stat-card"},{default:t(()=>[s("div",dt,[s("div",ut,[e(i,null,{default:t(()=>[e(f(Y))]),_:1})]),s("div",_t,[s("div",pt,m(p.totalEquipment),1),a[1]||(a[1]=s("div",{class:"stat-label"},"设备总数",-1))])])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(o,{class:"stat-card"},{default:t(()=>[s("div",mt,[s("div",ft,[e(i,null,{default:t(()=>[e(f(Z))]),_:1})]),s("div",vt,[s("div",yt,m(p.totalUsers),1),a[2]||(a[2]=s("div",{class:"stat-label"},"用户总数",-1))])])]),_:1})]),_:1}),e(l,{span:6},{default:t(()=>[e(o,{class:"stat-card"},{default:t(()=>[s("div",ht,[s("div",gt,[e(i,null,{default:t(()=>[e(f(tt))]),_:1})]),s("div",bt,[s("div",Ct,m(p.totalReservations),1),a[3]||(a[3]=s("div",{class:"stat-label"},"预约总数",-1))])])]),_:1})]),_:1})]),_:1}),e(r,{gutter:20,class:"charts-row"},{default:t(()=>[e(l,{span:12},{default:t(()=>[e(o,null,{header:t(()=>[...a[4]||(a[4]=[s("span",null,"预约趋势",-1)])]),default:t(()=>[s("div",{ref_key:"reservationTrendChart",ref:h,style:{height:"300px"}},null,512)]),_:1})]),_:1}),e(l,{span:12},{default:t(()=>[e(o,null,{header:t(()=>[...a[5]||(a[5]=[s("span",null,"实验室使用率",-1)])]),default:t(()=>[s("div",{ref_key:"labUsageChart",ref:g,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),e(r,{gutter:20,class:"charts-row"},{default:t(()=>[e(l,{span:12},{default:t(()=>[e(o,null,{header:t(()=>[...a[6]||(a[6]=[s("span",null,"设备状态分布",-1)])]),default:t(()=>[s("div",{ref_key:"equipmentStatusChart",ref:b,style:{height:"300px"}},null,512)]),_:1})]),_:1}),e(l,{span:12},{default:t(()=>[e(o,null,{header:t(()=>[...a[7]||(a[7]=[s("span",null,"用户类型分布",-1)])]),default:t(()=>[s("div",{ref_key:"userTypeChart",ref:C,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),e(o,{class:"recent-activities"},{header:t(()=>[...a[8]||(a[8]=[s("span",null,"最近活动",-1)])]),default:t(()=>[e(k,null,{default:t(()=>[(y(!0),F(q,null,Q(x.value,d=>(y(),$(c,{key:d.id,timestamp:d.timestamp,type:d.type},{default:t(()=>[G(m(d.content),1)]),_:2},1032,["timestamp","type"]))),128))]),_:1})]),_:1})])}}},Dt=M(xt,[["__scopeId","data-v-244af274"]]);export{Dt as default};
