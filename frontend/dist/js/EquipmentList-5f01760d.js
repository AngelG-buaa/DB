import{_ as Le}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                             *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                *//* empty css               *//* empty css                             *//* empty css                  */import{u as Fe,a as Te,r as g,b as F,v as ue,o as ie,ah as Ae,c as v,d as U,f as e,w as t,a5 as $e,x as Be,e as D,z as k,N as I,j as r,A as H,g as Pe,F as de,y as pe,ai as je,t as i,O as me,k as T,P as Oe,J as h,Q as He,E as Ke,l as Je,a7 as Qe,n as We,p as Ge,ap as Xe,a6 as Ze,ak as ea,s as aa,a8 as la,al as ta,am as na,m as oa,aj as ra,h as sa,an as ua,ao as ia,aq as da,ae as pa,ar as ce,as as ma,at as ca}from"./index-edaa0abb.js";import{g as fa,a as _a,u as ba,c as ga,d as ya}from"./equipment-83c8887c.js";import{c as va}from"./maintenance-af8db85b.js";import{getLabsApi as Va}from"./lab-b5105c5b.js";const wa={class:"equipment-list-container"},Da={class:"card-header"},ka={class:"search-section"},ha={key:1},Ya={class:"pagination-section"},Ca={key:0,class:"equipment-detail"},Ea={__name:"EquipmentList",setup(xa){const K=Fe(),fe=Te(),A=g(!1),z=g(!1),N=g(!1),Y=g(!1),$=g(!1),C=g(!1),E=g(!1),J=g([]),p=g(null),B=g([]),x=g(),P=g(),d=F({keyword:"",labId:"",status:"",purchaseDateRange:[]}),_=F({page:1,size:20,total:0}),o=F({id:null,name:"",model:"",serialNumber:"",labId:"",status:"available",purchaseDate:"",warrantyUntil:"",description:""}),u=F({equipmentId:null,type:"maintenance",description:"",cost:0,technician:"",expectedCompletionDate:""}),_e=ue(()=>fe.userInfo),be=ue(()=>E.value?"编辑设备":"新增设备"),ge={name:[{required:!0,message:"请输入设备名称",trigger:"blur"},{min:2,max:50,message:"名称长度在 2 到 50 个字符",trigger:"blur"}],model:[{required:!0,message:"请输入设备型号",trigger:"blur"},{min:1,max:50,message:"型号长度在 1 到 50 个字符",trigger:"blur"}],serialNumber:[{required:!0,message:"请输入设备序列号",trigger:"blur"},{min:1,max:100,message:"长度在 1 到 100 个字符",trigger:"blur"}],labId:[{required:!0,message:"请选择所属实验室",trigger:"change"}],status:[{required:!0,message:"请选择设备状态",trigger:"change"}],price:[{required:!0,message:"请输入设备价格",trigger:"blur"},{type:"number",min:0,message:"价格不能为负数",trigger:"blur"}],purchaseDate:[{required:!0,message:"请选择购买日期",trigger:"change"}]};ie(()=>{V(),W()}),Ae(()=>{V()});const ye={type:[{required:!0,message:"请选择维修类型",trigger:"change"}],description:[{required:!0,message:"请输入问题描述",trigger:"blur"},{min:10,max:500,message:"描述长度在 10 到 500 个字符",trigger:"blur"}]},Q=n=>n.includes(_e.value.user_type),W=async()=>{try{const n=await Va({page:1,page_size:100});n.code===200&&(B.value=n.data.list)}catch(n){console.error("加载实验室选项失败:",n)}},V=async()=>{A.value=!0;try{const n={page:_.page,page_size:_.size};d.keyword&&(n.search=d.keyword),d.labId&&(n.laboratory_id=d.labId),d.status&&(n.status=d.status==="normal"?"available":d.status==="broken"?"damaged":d.status==="scrapped"?"retired":d.status);const a=await fa(n);a.code===200&&(J.value=(a.data.list||[]).map(s=>{var f;return{id:s.id,name:s.name,model:s.model,lab_id:s.laboratory_id||void 0,lab_name:((f=s.laboratory)==null?void 0:f.name)||"",status:s.status==="available"?"normal":s.status==="damaged"?"broken":s.status==="retired"?"scrapped":s.status,price:s.price||0,purchase_date:s.purchase_date,warranty_until:s.warranty_until||s.warranty_date,supplier:s.supplier||"",description:s.description,maintenance_count:s.maintenance_count||0,created_at:s.created_at,updated_at:s.updated_at}}),_.total=a.data.total)}catch(n){console.error("加载设备列表失败:",n)}finally{A.value=!1}},G=()=>{_.page=1,V()},ve=()=>{d.keyword="",d.labId="",d.status="",d.purchaseDateRange=[],_.page=1,V()},Ve=n=>{_.size=n,_.page=1,V()},we=n=>{_.page=n,V()},De=()=>{E.value=!1,Z(),Y.value=!0},ke=async n=>{try{const a=await _a(n.id);a.code===200&&(p.value=a.data,$.value=!0)}catch(a){console.error("获取设备详情失败:",a)}},he=n=>{p.value=n,u.equipmentId=n.id,u.type="maintenance",u.description="",u.cost=0,u.technician="",u.expectedCompletionDate="",C.value=!0},Ye=n=>{K.push(`/equipment/maintenance?equipment_id=${n.id}`)},Ce=n=>{K.push(`/laboratory/list?id=${n}`)},Ee=()=>{T.info("导出功能开发中...")},xe=async()=>{if(x.value)try{await x.value.validate(),z.value=!0;const n={name:o.name,model:o.model,serial_number:o.serialNumber,laboratory_id:o.labId,status:o.status==="normal"?"available":o.status==="broken"?"damaged":o.status==="scrapped"?"retired":o.status,purchase_date:o.purchaseDate,warranty_date:o.warrantyUntil,description:o.description},a=E.value?ba:ga,s=E.value?[o.id,n]:[n];(await a(...s)).code===200&&(T.success(E.value?"更新成功":"创建成功"),Y.value=!1,V())}catch(n){console.error("提交失败:",n)}finally{z.value=!1}},qe=async()=>{if(P.value)try{await P.value.validate(),N.value=!0;const n={equipment_id:u.equipmentId,type:u.type,description:u.description,cost:u.cost,technician:u.technician,expected_completion_date:u.expectedCompletionDate};(await va(n)).code===200&&(T.success("维修记录创建成功"),C.value=!1,V())}catch(n){console.error("提交维修记录失败:",n)}finally{N.value=!1}},Me=async n=>{try{await Oe.confirm(`确定要删除设备 "${n.name}" 吗？此操作不可恢复。`,"确认删除",{type:"warning"}),(await ya(n.id)).code===200&&(T.success("删除成功"),V())}catch(a){a!=="cancel"&&console.error("删除失败:",a)}},X=()=>{Y.value=!1,Z()},Z=()=>{o.id=null,o.name="",o.model="",o.serialNumber="",o.labId="",o.status="normal",o.purchaseDate="",o.warrantyUntil="",o.description="",x.value&&x.value.clearValidate()},ee=n=>h(n).format("YYYY-MM-DD HH:mm"),R=n=>h(n).isValid()?h(n).format("YYYY-MM-DD"):"-",ae=n=>Number(n).toLocaleString(),le=n=>h(n).isValid()?h(n).isBefore(h()):!1,te=n=>({normal:"success",maintenance:"warning",broken:"danger",scrapped:"info"})[n]||"info",ne=n=>({normal:"正常",maintenance:"维护中",broken:"故障",scrapped:"报废"})[n]||n;return ie(()=>{W(),V()}),(n,a)=>{const s=He,f=Ke,w=Je,q=Qe,m=We,M=Ge,S=Xe,Ue=Ze,y=ea,j=aa,oe=la,Ie=ta,ze=na,Ne=$e,c=oa,re=ra,se=sa,O=Be,b=ua,Re=ia,Se=da;return v(),U("div",wa,[e(Ne,null,{header:t(()=>[D("div",Da,[a[26]||(a[26]=D("span",null,"设备管理",-1)),Q(["admin","teacher"])?(v(),k(f,{key:0,type:"primary",onClick:De},{default:t(()=>[e(s,null,{default:t(()=>[e(I(pa))]),_:1}),a[25]||(a[25]=r(" 新增设备 ",-1))]),_:1})):H("",!0)])]),default:t(()=>[D("div",ka,[e(Ue,{gutter:20},{default:t(()=>[e(q,{span:5},{default:t(()=>[e(w,{modelValue:d.keyword,"onUpdate:modelValue":a[0]||(a[0]=l=>d.keyword=l),placeholder:"搜索设备名称或型号",clearable:"",onKeyup:Pe(G,["enter"])},{prefix:t(()=>[e(s,null,{default:t(()=>[e(I(ce))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(q,{span:4},{default:t(()=>[e(M,{modelValue:d.labId,"onUpdate:modelValue":a[1]||(a[1]=l=>d.labId=l),placeholder:"选择实验室",clearable:""},{default:t(()=>[e(m,{label:"全部实验室",value:""}),(v(!0),U(de,null,pe(B.value,l=>(v(),k(m,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(q,{span:4},{default:t(()=>[e(M,{modelValue:d.status,"onUpdate:modelValue":a[2]||(a[2]=l=>d.status=l),placeholder:"设备状态",clearable:""},{default:t(()=>[e(m,{label:"全部状态",value:""}),e(m,{label:"正常",value:"normal"}),e(m,{label:"维护中",value:"maintenance"}),e(m,{label:"故障",value:"broken"}),e(m,{label:"报废",value:"scrapped"})]),_:1},8,["modelValue"])]),_:1}),e(q,{span:4},{default:t(()=>[e(S,{modelValue:d.purchaseDateRange,"onUpdate:modelValue":a[3]||(a[3]=l=>d.purchaseDateRange=l),type:"daterange","range-separator":"至","start-placeholder":"购买开始日期","end-placeholder":"购买结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(q,{span:7},{default:t(()=>[e(f,{type:"primary",onClick:G},{default:t(()=>[e(s,null,{default:t(()=>[e(I(ce))]),_:1}),a[27]||(a[27]=r(" 搜索 ",-1))]),_:1}),e(f,{onClick:ve},{default:t(()=>[e(s,null,{default:t(()=>[e(I(ma))]),_:1}),a[28]||(a[28]=r(" 重置 ",-1))]),_:1}),e(f,{type:"success",onClick:Ee},{default:t(()=>[e(s,null,{default:t(()=>[e(I(ca))]),_:1}),a[29]||(a[29]=r(" 导出 ",-1))]),_:1})]),_:1})]),_:1})]),je((v(),k(Ie,{data:J.value,stripe:"",class:"equipment-table"},{default:t(()=>[e(y,{type:"selection",width:"55"}),e(y,{prop:"id",label:"ID",width:"80"}),e(y,{prop:"name",label:"设备名称","min-width":"150"},{default:t(({row:l})=>[e(j,{type:"primary",onClick:L=>ke(l)},{default:t(()=>[r(i(l.name),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"model",label:"型号","min-width":"120"}),e(y,{prop:"lab_name",label:"所属实验室","min-width":"120"},{default:t(({row:l})=>[e(j,{type:"primary",onClick:L=>Ce(l.lab_id)},{default:t(()=>[r(i(l.lab_name),1)]),_:2},1032,["onClick"])]),_:1}),e(y,{prop:"status",label:"状态",width:"100"},{default:t(({row:l})=>[e(oe,{type:te(l.status)},{default:t(()=>[r(i(ne(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"price",label:"价格",width:"100"},{default:t(({row:l})=>[r(" ¥"+i(ae(l.price)),1)]),_:1}),e(y,{prop:"purchase_date",label:"购买日期",width:"120"},{default:t(({row:l})=>[r(i(R(l.purchase_date)),1)]),_:1}),e(y,{prop:"warranty_until",label:"保修期至",width:"120"},{default:t(({row:l})=>[D("span",{class:me({"warranty-expired":le(l.warranty_until)})},i(R(l.warranty_until)),3)]),_:1}),e(y,{prop:"maintenance_count",label:"维修次数",width:"100"},{default:t(({row:l})=>[l.maintenance_count>0?(v(),k(j,{key:0,type:"primary",onClick:L=>Ye(l)},{default:t(()=>[r(i(l.maintenance_count)+"次 ",1)]),_:2},1032,["onClick"])):(v(),U("span",ha,"0次"))]),_:1}),Q(["admin","teacher"])?(v(),k(y,{key:0,label:"操作",width:"200",fixed:"right"},{default:t(({row:l})=>[e(f,{type:"warning",size:"small",onClick:L=>he(l)},{default:t(()=>[...a[30]||(a[30]=[r(" 维修 ",-1)])]),_:1},8,["onClick"]),e(f,{type:"danger",size:"small",onClick:L=>Me(l)},{default:t(()=>[...a[31]||(a[31]=[r(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})):H("",!0)]),_:1},8,["data"])),[[Se,A.value]]),D("div",Ya,[e(ze,{"current-page":_.page,"onUpdate:currentPage":a[4]||(a[4]=l=>_.page=l),"page-size":_.size,"onUpdate:pageSize":a[5]||(a[5]=l=>_.size=l),total:_.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Ve,onCurrentChange:we},null,8,["current-page","page-size","total"])])]),_:1}),e(O,{modelValue:Y.value,"onUpdate:modelValue":a[16]||(a[16]=l=>Y.value=l),title:be.value,width:"600px","before-close":X},{footer:t(()=>[e(f,{onClick:X},{default:t(()=>[...a[32]||(a[32]=[r("取消",-1)])]),_:1}),e(f,{type:"primary",loading:z.value,onClick:xe},{default:t(()=>[r(i(z.value?"提交中...":"确定"),1)]),_:1},8,["loading"])]),default:t(()=>[e(se,{ref_key:"equipmentFormRef",ref:x,model:o,rules:ge,"label-width":"100px"},{default:t(()=>[e(c,{label:"设备名称",prop:"name"},{default:t(()=>[e(w,{modelValue:o.name,"onUpdate:modelValue":a[6]||(a[6]=l=>o.name=l),placeholder:"请输入设备名称",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"型号",prop:"model"},{default:t(()=>[e(w,{modelValue:o.model,"onUpdate:modelValue":a[7]||(a[7]=l=>o.model=l),placeholder:"请输入设备型号",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"序列号",prop:"serialNumber"},{default:t(()=>[e(w,{modelValue:o.serialNumber,"onUpdate:modelValue":a[8]||(a[8]=l=>o.serialNumber=l),placeholder:"请输入设备序列号",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"所属实验室",prop:"labId"},{default:t(()=>[e(M,{modelValue:o.labId,"onUpdate:modelValue":a[9]||(a[9]=l=>o.labId=l),style:{width:"100%"}},{default:t(()=>[(v(!0),U(de,null,pe(B.value,l=>(v(),k(m,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"状态",prop:"status"},{default:t(()=>[e(M,{modelValue:o.status,"onUpdate:modelValue":a[10]||(a[10]=l=>o.status=l),style:{width:"100%"}},{default:t(()=>[e(m,{label:"正常",value:"normal"}),e(m,{label:"维护中",value:"maintenance"}),e(m,{label:"故障",value:"broken"}),e(m,{label:"报废",value:"scrapped"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"价格",prop:"price"},{default:t(()=>[e(re,{modelValue:o.price,"onUpdate:modelValue":a[11]||(a[11]=l=>o.price=l),min:0,precision:2,placeholder:"请输入设备价格",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"购买日期",prop:"purchaseDate"},{default:t(()=>[e(S,{modelValue:o.purchaseDate,"onUpdate:modelValue":a[12]||(a[12]=l=>o.purchaseDate=l),type:"date",placeholder:"请选择购买日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"保修期至",prop:"warrantyUntil"},{default:t(()=>[e(S,{modelValue:o.warrantyUntil,"onUpdate:modelValue":a[13]||(a[13]=l=>o.warrantyUntil=l),type:"date",placeholder:"请选择保修期结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"供应商"},{default:t(()=>[e(w,{modelValue:o.supplier,"onUpdate:modelValue":a[14]||(a[14]=l=>o.supplier=l),placeholder:"请输入供应商名称（可选）",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"描述"},{default:t(()=>[e(w,{modelValue:o.description,"onUpdate:modelValue":a[15]||(a[15]=l=>o.description=l),type:"textarea",rows:4,placeholder:"请输入设备描述（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),e(O,{modelValue:$.value,"onUpdate:modelValue":a[17]||(a[17]=l=>$.value=l),title:"设备详情",width:"800px"},{default:t(()=>[p.value?(v(),U("div",Ca,[e(Re,{column:2,border:""},{default:t(()=>[e(b,{label:"ID"},{default:t(()=>[r(i(p.value.id),1)]),_:1}),e(b,{label:"名称"},{default:t(()=>[r(i(p.value.name),1)]),_:1}),e(b,{label:"型号"},{default:t(()=>[r(i(p.value.model),1)]),_:1}),e(b,{label:"所属实验室"},{default:t(()=>[r(i(p.value.lab_name),1)]),_:1}),e(b,{label:"状态"},{default:t(()=>[e(oe,{type:te(p.value.status)},{default:t(()=>[r(i(ne(p.value.status)),1)]),_:1},8,["type"])]),_:1}),e(b,{label:"价格"},{default:t(()=>[r(" ¥"+i(ae(p.value.price)),1)]),_:1}),e(b,{label:"购买日期"},{default:t(()=>[r(i(R(p.value.purchase_date)),1)]),_:1}),e(b,{label:"保修期至"},{default:t(()=>[D("span",{class:me({"warranty-expired":le(p.value.warranty_until)})},i(R(p.value.warranty_until)),3)]),_:1}),e(b,{label:"供应商"},{default:t(()=>[r(i(p.value.supplier||"无"),1)]),_:1}),e(b,{label:"维修次数"},{default:t(()=>[r(i(p.value.maintenance_count)+"次 ",1)]),_:1}),e(b,{label:"描述",span:2},{default:t(()=>[r(i(p.value.description||"无"),1)]),_:1}),e(b,{label:"创建时间"},{default:t(()=>[r(i(ee(p.value.created_at)),1)]),_:1}),e(b,{label:"更新时间"},{default:t(()=>[r(i(ee(p.value.updated_at)),1)]),_:1})]),_:1})])):H("",!0)]),_:1},8,["modelValue"]),e(O,{modelValue:C.value,"onUpdate:modelValue":a[24]||(a[24]=l=>C.value=l),title:"设备维修",width:"600px"},{footer:t(()=>[e(f,{onClick:a[23]||(a[23]=l=>C.value=!1)},{default:t(()=>[...a[33]||(a[33]=[r("取消",-1)])]),_:1}),e(f,{type:"primary",loading:N.value,onClick:qe},{default:t(()=>[r(i(N.value?"提交中...":"提交维修"),1)]),_:1},8,["loading"])]),default:t(()=>[e(se,{ref_key:"maintenanceFormRef",ref:P,model:u,rules:ye,"label-width":"100px"},{default:t(()=>[e(c,{label:"维修类型",prop:"type"},{default:t(()=>[e(M,{modelValue:u.type,"onUpdate:modelValue":a[18]||(a[18]=l=>u.type=l),style:{width:"100%"}},{default:t(()=>[e(m,{label:"定期保养",value:"maintenance"}),e(m,{label:"故障维修",value:"repair"}),e(m,{label:"升级改造",value:"upgrade"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"问题描述",prop:"description"},{default:t(()=>[e(w,{modelValue:u.description,"onUpdate:modelValue":a[19]||(a[19]=l=>u.description=l),type:"textarea",rows:4,placeholder:"请描述设备问题或维修内容"},null,8,["modelValue"])]),_:1}),e(c,{label:"维修费用"},{default:t(()=>[e(re,{modelValue:u.cost,"onUpdate:modelValue":a[20]||(a[20]=l=>u.cost=l),min:0,precision:2,placeholder:"请输入维修费用",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(c,{label:"维修人员"},{default:t(()=>[e(w,{modelValue:u.technician,"onUpdate:modelValue":a[21]||(a[21]=l=>u.technician=l),placeholder:"请输入维修人员姓名",clearable:""},null,8,["modelValue"])]),_:1}),e(c,{label:"预计完成时间"},{default:t(()=>[e(S,{modelValue:u.expectedCompletionDate,"onUpdate:modelValue":a[22]||(a[22]=l=>u.expectedCompletionDate=l),type:"date",placeholder:"请选择预计完成时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Xa=Le(Ea,[["__scopeId","data-v-79979930"]]);export{Xa as default};
