import{u as T,r as i,b as q,H as O,o as P,c as d,d as p,f as t,w as r,aF as c,k as u,a5 as z,e as C,F as k,y as R,z as b,j as _,A as j,l as M,m as S,aj as $,n as G,p as H,C as Y,D as J,E as K,h as Q}from"./index-0407e335.js";import{_ as W}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                *//* empty css                 *//* empty css                  *//* empty css                       *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        */const X={class:"course-create"},Z={__name:"Create",setup(ee){const f=T(),g=i(),m=i(!1),v=i([]),V=i([]),a=q({course_name:"",credit:1,teacher_id:null,need_lab:!1,lab_id:null,description:""}),A={course_name:[{required:!0,message:"请输入课程名称",trigger:"blur"},{min:2,max:100,message:"长度在 2 到 100 个字符",trigger:"blur"}],credit:[{required:!0,message:"请输入学分",trigger:"blur"},{type:"number",min:1,max:10,message:"学分范围为 1-10",trigger:"blur"}],teacher_id:[{required:!0,message:"请选择授课教师",trigger:"change"}],need_lab:[{required:!0,message:"请选择是否需要实验室",trigger:"change"}],lab_id:[{validator:(s,e,o)=>{a.need_lab&&!e?o(new Error("需要实验室时必须选择实验室")):o()},trigger:"change"}]};O(()=>a.need_lab,s=>{s||(a.lab_id=null)});const I=async()=>{try{const e=await(await c(()=>import("./user-08aa0f2d.js"),["js/user-08aa0f2d.js","js/index-0407e335.js","css/index-5da0789f.css"])).getUsersApi({page:1,page_size:200,role:"teacher"});e.code===200&&(v.value=(e.data.list||[]).map(o=>({user_id:o.id,user_name:o.name||o.username})))}catch{u.error("加载教师列表失败")}},U=async()=>{try{const e=await(await c(()=>import("./lab-ae8b6f89.js"),["js/lab-ae8b6f89.js","js/index-0407e335.js","css/index-5da0789f.css"])).getLabsApi({page:1,page_size:200});e.code===200&&(V.value=(e.data.list||[]).map(o=>({lab_id:o.id,lab_name:o.name})))}catch{u.error("加载实验室列表失败")}},D=async()=>{try{await g.value.validate(),m.value=!0;const s=await c(()=>import("./course-750d183b.js"),["js/course-750d183b.js","js/index-0407e335.js","css/index-5da0789f.css"]),e=`${new Date().getFullYear()}秋`,o=`C${Date.now()}`,n={name:a.course_name,code:o,description:a.description,credits:a.credit,semester:e,teacher_id:a.teacher_id,status:"active"};(await s.createCourseApi(n)).code===200&&(u.success("课程创建成功"),f.push("/course/list"))}catch(s){s!==!1&&u.error("创建失败，请重试")}finally{m.value=!1}},F=()=>{f.back()};return P(()=>{I(),U()}),(s,e)=>{const o=M,n=S,w=$,y=G,E=H,x=Y,L=J,h=K,B=Q,N=z;return d(),p("div",X,[t(N,null,{header:r(()=>[...e[6]||(e[6]=[C("div",{class:"card-header"},[C("span",null,"新增课程")],-1)])]),default:r(()=>[t(B,{ref_key:"formRef",ref:g,model:a,rules:A,"label-width":"120px",class:"course-form"},{default:r(()=>[t(n,{label:"课程名称",prop:"course_name"},{default:r(()=>[t(o,{modelValue:a.course_name,"onUpdate:modelValue":e[0]||(e[0]=l=>a.course_name=l),placeholder:"请输入课程名称",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(n,{label:"学分",prop:"credit"},{default:r(()=>[t(w,{modelValue:a.credit,"onUpdate:modelValue":e[1]||(e[1]=l=>a.credit=l),min:1,max:10,placeholder:"请输入学分",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(n,{label:"授课教师",prop:"teacher_id"},{default:r(()=>[t(E,{modelValue:a.teacher_id,"onUpdate:modelValue":e[2]||(e[2]=l=>a.teacher_id=l),placeholder:"请选择授课教师",filterable:""},{default:r(()=>[(d(!0),p(k,null,R(v.value,l=>(d(),b(y,{key:l.user_id,label:l.user_name,value:l.user_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(n,{label:"需要实验室",prop:"need_lab"},{default:r(()=>[t(L,{modelValue:a.need_lab,"onUpdate:modelValue":e[3]||(e[3]=l=>a.need_lab=l)},{default:r(()=>[t(x,{label:!0},{default:r(()=>[...e[7]||(e[7]=[_("是",-1)])]),_:1}),t(x,{label:!1},{default:r(()=>[...e[8]||(e[8]=[_("否",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a.need_lab?(d(),b(n,{key:0,label:"关联实验室",prop:"lab_id"},{default:r(()=>[t(E,{modelValue:a.lab_id,"onUpdate:modelValue":e[4]||(e[4]=l=>a.lab_id=l),placeholder:"请选择实验室",filterable:""},{default:r(()=>[(d(!0),p(k,null,R(V.value,l=>(d(),b(y,{key:l.lab_id,label:l.lab_name,value:l.lab_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):j("",!0),t(n,{label:"课程描述",prop:"description"},{default:r(()=>[t(o,{modelValue:a.description,"onUpdate:modelValue":e[5]||(e[5]=l=>a.description=l),type:"textarea",rows:4,placeholder:"请输入课程描述（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(n,null,{default:r(()=>[t(h,{type:"primary",onClick:D,loading:m.value},{default:r(()=>[...e[9]||(e[9]=[_(" 创建 ",-1)])]),_:1},8,["loading"]),t(h,{onClick:F},{default:r(()=>[...e[10]||(e[10]=[_("取消",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},_e=W(Z,[["__scopeId","data-v-50e56eb0"]]);export{_e as default};
