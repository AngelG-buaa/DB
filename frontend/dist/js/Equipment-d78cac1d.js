import{_ as X}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  *//* empty css               *//* empty css               *//* empty css                *//* empty css                 *//* empty css                  *//* empty css                  */import{r as u,b as P,o as Y,a4 as S,c as V,d as Q,f as a,w as e,a5 as Z,a6 as $,F as tt,y as at,z as et,j as h,e as n,N as C,t as y,n as nt,p as st,m as ot,l as lt,E as it,h as rt,Q as ct,a7 as dt,ak as ut,a8 as pt,al as _t,af as mt,aM as ft,aN as bt,ac as yt}from"./index-0407e335.js";import{i as g}from"./index-18acf776.js";import{b as G}from"./equipment-16832688.js";import{getLabsApi as vt}from"./lab-ae8b6f89.js";import{e as ht}from"./maintenance-0ef2aad3.js";const gt={class:"equipment-statistics"},xt={class:"stat-content"},wt={class:"stat-icon total-icon"},Ct={class:"stat-info"},Et={class:"stat-number"},kt={class:"stat-content"},qt={class:"stat-icon normal-icon"},At={class:"stat-info"},Ft={class:"stat-number"},St={class:"stat-content"},Vt={class:"stat-icon maintenance-icon"},Tt={class:"stat-info"},Ot={class:"stat-number"},Nt={class:"stat-content"},Bt={class:"stat-icon broken-icon"},Dt={class:"stat-info"},It={class:"stat-number"},Mt={__name:"Equipment",setup(Lt){const T=u(),O=u(),N=u(),B=u(),D=u(),I=u([]),M=u([]),x=u([]),L=u([]),p=P({lab_id:null,status:null,equipment_type:""}),c=P({total:0,normal:0,maintenance:0,broken:0}),H=async()=>{try{const s=await vt({page:1,page_size:100});I.value=s.code===200?s.data.list||[]:[]}catch(s){console.error("加载实验室列表失败:",s)}},U=async()=>{try{const s=await G();if(s.code===200){const t=s.data||{},o=t.status_distribution||{};c.total=t.total_equipment||0,c.normal=o.available||0,c.maintenance=o.maintenance||0,c.broken=o.damaged||0,x.value=t.laboratory_distribution||[],L.value=t.warranty_expiring_soon||[],S(()=>{E(),k(),q(),A()})}}catch(s){console.error("加载设备统计失败:",s)}},j=async()=>{var s;try{const t=await G();if(t.code===200){const o=((s=t.data)==null?void 0:s.laboratory_distribution)||[];M.value=o.map(i=>({lab_name:i.laboratory_name,total_equipment:i.equipment_count,normal_count:0,maintenance_count:0,broken_count:0,normal_rate:0,avg_usage:0,maintenance_cost:0}))}}catch(t){console.error("加载详细统计失败:",t)}},E=()=>{const s=g(T.value),t={tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},series:[{name:"设备状态",type:"pie",radius:"60%",data:[{value:c.normal,name:"正常"},{value:c.maintenance,name:"维护中"},{value:c.broken,name:"故障"}],itemStyle:{color:function(o){return["#67C23A","#E6A23C","#F56C6C"][o.dataIndex]}}}]};s.setOption(t)},k=()=>{const s=g(O.value),t=(x.value||[]).map(i=>({value:i.equipment_count,name:i.laboratory_name})),o={tooltip:{trigger:"item"},series:[{type:"pie",radius:["40%","70%"],data:t}]};s.setOption(o)},q=()=>{const s=g(N.value),t=(x.value||[]).map(r=>r.laboratory_name),o=(x.value||[]).map(r=>r.equipment_count),i={tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},xAxis:{type:"category",data:t},yAxis:{type:"value"},series:[{data:o,type:"bar",itemStyle:{color:"#409EFF"}}]};s.setOption(i)},A=()=>{const s=g(B.value),t={"0-7天":0,"8-15天":0,"16-30天":0};for(const f of L.value||[]){const b=Number(f.days_left||0);b<=7?t["0-7天"]+=1:b<=15?t["8-15天"]+=1:t["16-30天"]+=1}const o=Object.keys(t),i=o.map(f=>t[f]),r={tooltip:{trigger:"axis"},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[{data:i,type:"bar",itemStyle:{color:"#67C23A"}}]};s.setOption(r)},z=async()=>{const s=g(D.value),t=await ht({months:6}),o=t.code===200?t.data.months||[]:[],i=t.code===200?t.data.series||[]:[],r=i.map(v=>v.count),f=i.map(v=>v.total_cost),b={tooltip:{trigger:"axis"},legend:{data:["维护次数","维护成本"]},xAxis:{type:"category",data:o},yAxis:[{type:"value",name:"维护次数",position:"left"},{type:"value",name:"维护成本(元)",position:"right"}],series:[{name:"维护次数",type:"bar",data:r,itemStyle:{color:"#409EFF"}},{name:"维护成本",type:"line",yAxisIndex:1,data:f,itemStyle:{color:"#E6A23C"}}]};s.setOption(b)},R=async()=>{await U(),await j(),S(()=>{E(),k(),q(),A(),z()})},J=()=>{Object.assign(p,{lab_id:null,status:null,equipment_type:""}),R()};return Y(async()=>{await H(),await U(),await j(),S(()=>{E(),k(),q(),A(),z()})}),(s,t)=>{const o=nt,i=st,r=ot,f=lt,b=it,v=rt,d=Z,w=ct,_=dt,F=$,m=ut,K=pt,W=_t;return V(),Q("div",gt,[a(d,{class:"filter-card"},{default:e(()=>[a(v,{model:p,inline:""},{default:e(()=>[a(r,{label:"实验室"},{default:e(()=>[a(i,{modelValue:p.lab_id,"onUpdate:modelValue":t[0]||(t[0]=l=>p.lab_id=l),placeholder:"请选择实验室",clearable:"",filterable:""},{default:e(()=>[(V(!0),Q(tt,null,at(I.value,l=>(V(),et(o,{key:l.lab_id,label:l.lab_name,value:l.lab_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"设备状态"},{default:e(()=>[a(i,{modelValue:p.status,"onUpdate:modelValue":t[1]||(t[1]=l=>p.status=l),placeholder:"请选择状态",clearable:""},{default:e(()=>[a(o,{label:"正常",value:"Normal"}),a(o,{label:"维护中",value:"Maintenance"}),a(o,{label:"故障",value:"Broken"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"设备类型"},{default:e(()=>[a(f,{modelValue:p.equipment_type,"onUpdate:modelValue":t[2]||(t[2]=l=>p.equipment_type=l),placeholder:"请输入设备类型",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(r,null,{default:e(()=>[a(b,{type:"primary",onClick:R},{default:e(()=>[...t[3]||(t[3]=[h("查询",-1)])]),_:1}),a(b,{onClick:J},{default:e(()=>[...t[4]||(t[4]=[h("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(F,{gutter:20,class:"stats-cards"},{default:e(()=>[a(_,{span:6},{default:e(()=>[a(d,{class:"stat-card"},{default:e(()=>[n("div",xt,[n("div",wt,[a(w,null,{default:e(()=>[a(C(mt))]),_:1})]),n("div",Ct,[n("div",Et,y(c.total),1),t[5]||(t[5]=n("div",{class:"stat-label"},"设备总数",-1))])])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(d,{class:"stat-card"},{default:e(()=>[n("div",kt,[n("div",qt,[a(w,null,{default:e(()=>[a(C(ft))]),_:1})]),n("div",At,[n("div",Ft,y(c.normal),1),t[6]||(t[6]=n("div",{class:"stat-label"},"正常设备",-1))])])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(d,{class:"stat-card"},{default:e(()=>[n("div",St,[n("div",Vt,[a(w,null,{default:e(()=>[a(C(bt))]),_:1})]),n("div",Tt,[n("div",Ot,y(c.maintenance),1),t[7]||(t[7]=n("div",{class:"stat-label"},"维护中",-1))])])]),_:1})]),_:1}),a(_,{span:6},{default:e(()=>[a(d,{class:"stat-card"},{default:e(()=>[n("div",Nt,[n("div",Bt,[a(w,null,{default:e(()=>[a(C(yt))]),_:1})]),n("div",Dt,[n("div",It,y(c.broken),1),t[8]||(t[8]=n("div",{class:"stat-label"},"故障设备",-1))])])]),_:1})]),_:1})]),_:1}),a(F,{gutter:20,class:"charts-row"},{default:e(()=>[a(_,{span:12},{default:e(()=>[a(d,null,{header:e(()=>[...t[9]||(t[9]=[n("span",null,"设备状态分布",-1)])]),default:e(()=>[n("div",{ref_key:"statusChart",ref:T,style:{height:"300px"}},null,512)]),_:1})]),_:1}),a(_,{span:12},{default:e(()=>[a(d,null,{header:e(()=>[...t[10]||(t[10]=[n("span",null,"实验室设备分布",-1)])]),default:e(()=>[n("div",{ref_key:"typeChart",ref:O,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),a(F,{gutter:20,class:"charts-row"},{default:e(()=>[a(_,{span:12},{default:e(()=>[a(d,null,{header:e(()=>[...t[11]||(t[11]=[n("span",null,"实验室设备数量",-1)])]),default:e(()=>[n("div",{ref_key:"labEquipmentChart",ref:N,style:{height:"300px"}},null,512)]),_:1})]),_:1}),a(_,{span:12},{default:e(()=>[a(d,null,{header:e(()=>[...t[12]||(t[12]=[n("span",null,"保修到期分布",-1)])]),default:e(()=>[n("div",{ref_key:"usageFrequencyChart",ref:B,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),a(d,{class:"maintenance-trend-card"},{header:e(()=>[...t[13]||(t[13]=[n("span",null,"设备维护趋势",-1)])]),default:e(()=>[n("div",{ref_key:"maintenanceTrendChart",ref:D,style:{height:"400px"}},null,512)]),_:1}),a(d,{class:"table-card"},{header:e(()=>[...t[14]||(t[14]=[n("span",null,"设备详细统计",-1)])]),default:e(()=>[a(W,{data:M.value,stripe:"",style:{width:"100%"}},{default:e(()=>[a(m,{prop:"lab_name",label:"实验室","min-width":"120"}),a(m,{prop:"total_equipment",label:"设备总数",width:"100"}),a(m,{prop:"normal_count",label:"正常",width:"80"}),a(m,{prop:"maintenance_count",label:"维护中",width:"80"}),a(m,{prop:"broken_count",label:"故障",width:"80"}),a(m,{prop:"normal_rate",label:"正常率",width:"80"},{default:e(({row:l})=>[a(K,{type:l.normal_rate>=90?"success":l.normal_rate>=80?"warning":"danger"},{default:e(()=>[h(y(l.normal_rate)+"% ",1)]),_:2},1032,["type"])]),_:1}),a(m,{prop:"avg_usage",label:"平均使用率",width:"100"},{default:e(({row:l})=>[h(y(l.avg_usage)+"% ",1)]),_:1}),a(m,{prop:"maintenance_cost",label:"维护成本",width:"100"},{default:e(({row:l})=>[h(" ¥"+y(l.maintenance_cost),1)]),_:1})]),_:1},8,["data"])]),_:1})])}}},aa=X(Mt,[["__scopeId","data-v-48dff341"]]);export{aa as default};
