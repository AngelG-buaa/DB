import{_ as Pe}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                             *//* empty css                  *//* empty css                   *//* empty css                 *//* empty css                        *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                             *//* empty css                  *//* empty css               *//* empty css                */import{r as c,b as T,v as he,o as se,ah as ze,c as g,d as J,e as p,z as D,w as t,f as e,k as _,E as Re,a5 as Ye,a6 as Fe,x as Me,N as I,j as u,t as d,F as oe,y as ue,ai as Te,A as $,P as $e,Q as je,a7 as Be,l as Ne,m as Oe,n as Le,p as Ae,ap as Ge,h as He,ak as Qe,a8 as Je,al as Ke,am as We,aj as Xe,an as Ze,ao as el,aq as ll,ae as tl,aG as al,ac as sl,aH as ol,aI as ul,ar as rl,as as nl}from"./index-0407e335.js";import{a as dl,g as il,d as pl,u as ml,c as cl,b as fl,r as bl}from"./consumable-97bf65e8.js";import{getLabsApi as gl}from"./lab-ae8b6f89.js";const _l={class:"consumable-list"},vl={class:"page-header"},yl={class:"stats-cards"},kl={class:"stats-content"},Vl={class:"stats-number"},wl={class:"stats-content"},Cl={class:"stats-number"},Sl={class:"stats-content"},Dl={class:"stats-number"},Ul={class:"stats-content"},xl={class:"stats-number"},Il={class:"pagination-wrapper"},ql={__name:"ConsumableList",setup(El){const O=c(!1),C=c(!1),K=c([]),L=c([]),z=c({total:0,lowStock:0,monthlyUsage:0,totalValue:0}),m=T({keyword:"",labId:"",status:"",purchaseDateRange:[]}),f=T({page:1,size:20,total:0}),q=c(!1),A=c(!1),R=c(!1),Y=c(!1),F=c(!1),r=c(null),o=T({id:null,name:"",model:"",labId:"",currentStock:0,minStock:0,unit:"",unitPrice:0,supplier:"",purchaseDate:"",description:""}),S=T({quantity:1,userId:"",purpose:""}),b=T({quantity:1,unitPrice:0,supplier:"",remarks:""}),G=c(),W=c(),X=c(),re={name:[{required:!0,message:"请输入耗材名称",trigger:"blur"}],model:[{required:!0,message:"请输入型号或规格",trigger:"blur"}],labId:[{required:!0,message:"请选择实验室",trigger:"change"}],currentStock:[{required:!0,message:"请输入当前库存",trigger:"blur"}],minStock:[{required:!0,message:"请输入最低库存",trigger:"blur"}],unit:[{required:!0,message:"请输入单位",trigger:"blur"}],unitPrice:[{required:!0,message:"请输入单价",trigger:"blur"}],supplier:[{required:!0,message:"请输入供应商",trigger:"blur"}],purchaseDate:[{required:!0,message:"请选择采购日期",trigger:"change"}]},ne={quantity:[{required:!0,message:"请输入使用数量",trigger:"blur"}],userId:[{required:!0,message:"请输入使用人员ID",trigger:"blur"}],purpose:[{required:!0,message:"请输入使用目的",trigger:"blur"}]},de={quantity:[{required:!0,message:"请输入补货数量",trigger:"blur"}],unitPrice:[{required:!0,message:"请输入单价",trigger:"blur"}]},ie=he(()=>F.value?"编辑耗材":"添加耗材"),j=s=>!0,Z=(s,l)=>s<=0?"danger":s<=l?"warning":"success",v=async()=>{var s,l;O.value=!0;try{const V={page:f.page,page_size:f.size,search:m.keyword,laboratory_id:m.labId||void 0,status:m.status,date_from:(s=m.purchaseDateRange)==null?void 0:s[0],date_to:(l=m.purchaseDateRange)==null?void 0:l[1]},i=await dl(V);K.value=i.data.list,f.total=i.data.total}catch{_.error("加载数据失败")}finally{O.value=!1}},ee=async()=>{try{const s=await gl({page:1,page_size:1e3});L.value=s.code===200?s.data.list||s.data:[]}catch{_.error("加载实验室选项失败")}},x=async()=>{try{const s=await il();z.value=s.data}catch{_.error("加载统计数据失败")}},pe=()=>{f.page=1,v()},me=()=>{Object.assign(m,{keyword:"",labId:"",status:"",purchaseDateRange:[]}),f.page=1,v()},ce=s=>{f.size=s,f.page=1,v()},fe=s=>{f.page=s,v()},be=()=>{F.value=!1,le(),q.value=!0},ge=s=>{F.value=!0,Object.assign(o,s),q.value=!0},_e=s=>{r.value=s,A.value=!0},ve=s=>{r.value=s,Se(),R.value=!0},ye=s=>{r.value=s,De(),b.unitPrice=s.unitPrice,b.supplier=s.supplier,Y.value=!0};se(()=>{v(),ee(),x()}),ze(()=>{v(),x()});const ke=async s=>{try{await $e.confirm(`确定要删除耗材"${s.name}"吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await pl(s.id),_.success("删除成功"),v(),x()}catch(l){l!=="cancel"&&_.error("删除失败")}},Ve=async()=>{try{await G.value.validate(),C.value=!0;const s={name:o.name,model:o.model,laboratory_id:o.labId,unit:o.unit,unit_price:o.unitPrice,current_stock:o.currentStock,min_stock:o.minStock,supplier:o.supplier,purchase_date:o.purchaseDate,description:o.description};F.value?(await ml(o.id,s),_.success("更新成功")):(await cl(s),_.success("创建成功")),q.value=!1,v(),x()}catch(s){s!==!1&&_.error(F.value?"更新失败":"创建失败")}finally{C.value=!1}},we=async()=>{try{await W.value.validate(),C.value=!0,await fl(r.value.id,S),_.success("使用记录已保存"),R.value=!1,v(),x()}catch(s){s!==!1&&_.error("保存使用记录失败")}finally{C.value=!1}},Ce=async()=>{try{await X.value.validate(),C.value=!0,await bl(r.value.id,b),_.success("补货成功"),Y.value=!1,v(),x()}catch(s){s!==!1&&_.error("补货失败")}finally{C.value=!1}},le=()=>{Object.assign(o,{id:null,name:"",model:"",labId:"",currentStock:0,minStock:0,unit:"",unitPrice:0,supplier:"",purchaseDate:"",description:""})},Se=()=>{Object.assign(S,{quantity:1,userId:"",purpose:""})},De=()=>{Object.assign(b,{quantity:1,unitPrice:0,supplier:"",remarks:""})},Ue=()=>{var s;(s=G.value)==null||s.resetFields(),le()};return se(()=>{v(),ee(),x()}),(s,l)=>{const V=je,i=Re,E=Ye,U=Be,H=Fe,w=Ne,n=Oe,M=Le,Q=Ae,te=Ge,B=He,y=Qe,ae=Je,xe=Ke,Ie=We,P=Xe,N=Me,k=Ze,qe=el,Ee=ll;return g(),J("div",_l,[p("div",vl,[l[31]||(l[31]=p("h2",null,"耗材管理",-1)),(g(),D(i,{key:0,type:"primary",onClick:be},{default:t(()=>[e(V,null,{default:t(()=>[e(I(tl))]),_:1}),l[30]||(l[30]=u(" 添加耗材 ",-1))]),_:1}))]),p("div",yl,[e(H,{gutter:20},{default:t(()=>[e(U,{span:6},{default:t(()=>[e(E,{class:"stats-card"},{default:t(()=>[p("div",kl,[p("div",Vl,d(z.value.total),1),l[32]||(l[32]=p("div",{class:"stats-label"},"总耗材数",-1))]),e(V,{class:"stats-icon"},{default:t(()=>[e(I(al))]),_:1})]),_:1})]),_:1}),e(U,{span:6},{default:t(()=>[e(E,{class:"stats-card"},{default:t(()=>[p("div",wl,[p("div",Cl,d(z.value.lowStock),1),l[33]||(l[33]=p("div",{class:"stats-label"},"库存不足",-1))]),e(V,{class:"stats-icon low-stock"},{default:t(()=>[e(I(sl))]),_:1})]),_:1})]),_:1}),e(U,{span:6},{default:t(()=>[e(E,{class:"stats-card"},{default:t(()=>[p("div",Sl,[p("div",Dl,d(z.value.monthlyUsage),1),l[34]||(l[34]=p("div",{class:"stats-label"},"本月使用",-1))]),e(V,{class:"stats-icon"},{default:t(()=>[e(I(ol))]),_:1})]),_:1})]),_:1}),e(U,{span:6},{default:t(()=>[e(E,{class:"stats-card"},{default:t(()=>[p("div",Ul,[p("div",xl,"¥"+d(z.value.totalValue),1),l[35]||(l[35]=p("div",{class:"stats-label"},"总价值",-1))]),e(V,{class:"stats-icon"},{default:t(()=>[e(I(ul))]),_:1})]),_:1})]),_:1})]),_:1})]),e(E,{class:"search-card"},{default:t(()=>[e(B,{model:m,inline:""},{default:t(()=>[e(n,{label:"关键词"},{default:t(()=>[e(w,{modelValue:m.keyword,"onUpdate:modelValue":l[0]||(l[0]=a=>m.keyword=a),placeholder:"请输入耗材名称或型号",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(n,{label:"实验室"},{default:t(()=>[e(Q,{modelValue:m.labId,"onUpdate:modelValue":l[1]||(l[1]=a=>m.labId=a),placeholder:"请选择实验室",clearable:"",style:{width:"150px"}},{default:t(()=>[(g(!0),J(oe,null,ue(L.value,a=>(g(),D(M,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"状态"},{default:t(()=>[e(Q,{modelValue:m.status,"onUpdate:modelValue":l[2]||(l[2]=a=>m.status=a),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[e(M,{label:"正常",value:"normal"}),e(M,{label:"库存不足",value:"low_stock"}),e(M,{label:"缺货",value:"out_of_stock"})]),_:1},8,["modelValue"])]),_:1}),e(n,{label:"采购日期"},{default:t(()=>[e(te,{modelValue:m.purchaseDateRange,"onUpdate:modelValue":l[3]||(l[3]=a=>m.purchaseDateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"240px"}},null,8,["modelValue"])]),_:1}),e(n,null,{default:t(()=>[e(i,{type:"primary",onClick:pe},{default:t(()=>[e(V,null,{default:t(()=>[e(I(rl))]),_:1}),l[36]||(l[36]=u(" 搜索 ",-1))]),_:1}),e(i,{onClick:me},{default:t(()=>[e(V,null,{default:t(()=>[e(I(nl))]),_:1}),l[37]||(l[37]=u(" 重置 ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(E,{class:"table-card"},{default:t(()=>[Te((g(),D(xe,{data:K.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(y,{prop:"id",label:"ID",width:"80"}),e(y,{prop:"name",label:"耗材名称","min-width":"120"}),e(y,{prop:"model",label:"型号/规格","min-width":"100"}),e(y,{prop:"labName",label:"所属实验室","min-width":"120"}),e(y,{prop:"currentStock",label:"当前库存",width:"100"},{default:t(({row:a})=>[e(ae,{type:Z(a.currentStock,a.minStock),size:"small"},{default:t(()=>[u(d(a.currentStock)+" "+d(a.unit),1)]),_:2},1032,["type"])]),_:1}),e(y,{prop:"minStock",label:"最低库存",width:"100"},{default:t(({row:a})=>[u(d(a.minStock)+" "+d(a.unit),1)]),_:1}),e(y,{prop:"unitPrice",label:"单价",width:"100"},{default:t(({row:a})=>[u(" ¥"+d(a.unitPrice),1)]),_:1}),e(y,{prop:"supplier",label:"供应商","min-width":"120"}),e(y,{prop:"purchaseDate",label:"采购日期",width:"120"}),e(y,{prop:"usageCount",label:"使用次数",width:"100"}),e(y,{label:"操作",width:"280",fixed:"right"},{default:t(({row:a})=>[e(i,{type:"primary",size:"small",onClick:h=>_e(a)},{default:t(()=>[...l[38]||(l[38]=[u(" 详情 ",-1)])]),_:1},8,["onClick"]),j("consumable:use")?(g(),D(i,{key:0,type:"success",size:"small",onClick:h=>ve(a)},{default:t(()=>[...l[39]||(l[39]=[u(" 使用 ",-1)])]),_:1},8,["onClick"])):$("",!0),j("consumable:restock")?(g(),D(i,{key:1,type:"warning",size:"small",onClick:h=>ye(a)},{default:t(()=>[...l[40]||(l[40]=[u(" 补货 ",-1)])]),_:1},8,["onClick"])):$("",!0),j("consumable:update")?(g(),D(i,{key:2,size:"small",onClick:h=>ge(a)},{default:t(()=>[...l[41]||(l[41]=[u(" 编辑 ",-1)])]),_:1},8,["onClick"])):$("",!0),j("consumable:delete")?(g(),D(i,{key:3,type:"danger",size:"small",onClick:h=>ke(a)},{default:t(()=>[...l[42]||(l[42]=[u(" 删除 ",-1)])]),_:1},8,["onClick"])):$("",!0)]),_:1})]),_:1},8,["data"])),[[Ee,O.value]]),p("div",Il,[e(Ie,{"current-page":f.page,"onUpdate:currentPage":l[4]||(l[4]=a=>f.page=a),"page-size":f.size,"onUpdate:pageSize":l[5]||(l[5]=a=>f.size=a),"page-sizes":[10,20,50,100],total:f.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:ce,onCurrentChange:fe},null,8,["current-page","page-size","total"])])]),_:1}),e(N,{title:ie.value,modelValue:q.value,"onUpdate:modelValue":l[17]||(l[17]=a=>q.value=a),width:"600px",onClose:Ue},{footer:t(()=>[e(i,{onClick:l[16]||(l[16]=a=>q.value=!1)},{default:t(()=>[...l[43]||(l[43]=[u("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:Ve,loading:C.value},{default:t(()=>[...l[44]||(l[44]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(B,{model:o,rules:re,ref_key:"formRef",ref:G,"label-width":"100px"},{default:t(()=>[e(n,{label:"耗材名称",prop:"name"},{default:t(()=>[e(w,{modelValue:o.name,"onUpdate:modelValue":l[6]||(l[6]=a=>o.name=a),placeholder:"请输入耗材名称"},null,8,["modelValue"])]),_:1}),e(n,{label:"型号/规格",prop:"model"},{default:t(()=>[e(w,{modelValue:o.model,"onUpdate:modelValue":l[7]||(l[7]=a=>o.model=a),placeholder:"请输入型号或规格"},null,8,["modelValue"])]),_:1}),e(n,{label:"所属实验室",prop:"labId"},{default:t(()=>[e(Q,{modelValue:o.labId,"onUpdate:modelValue":l[8]||(l[8]=a=>o.labId=a),placeholder:"请选择实验室",style:{width:"100%"}},{default:t(()=>[(g(!0),J(oe,null,ue(L.value,a=>(g(),D(M,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(H,{gutter:20},{default:t(()=>[e(U,{span:12},{default:t(()=>[e(n,{label:"当前库存",prop:"currentStock"},{default:t(()=>[e(P,{modelValue:o.currentStock,"onUpdate:modelValue":l[9]||(l[9]=a=>o.currentStock=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:12},{default:t(()=>[e(n,{label:"最低库存",prop:"minStock"},{default:t(()=>[e(P,{modelValue:o.minStock,"onUpdate:modelValue":l[10]||(l[10]=a=>o.minStock=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(H,{gutter:20},{default:t(()=>[e(U,{span:12},{default:t(()=>[e(n,{label:"单位",prop:"unit"},{default:t(()=>[e(w,{modelValue:o.unit,"onUpdate:modelValue":l[11]||(l[11]=a=>o.unit=a),placeholder:"如：个、瓶、包"},null,8,["modelValue"])]),_:1})]),_:1}),e(U,{span:12},{default:t(()=>[e(n,{label:"单价",prop:"unitPrice"},{default:t(()=>[e(P,{modelValue:o.unitPrice,"onUpdate:modelValue":l[12]||(l[12]=a=>o.unitPrice=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(n,{label:"供应商",prop:"supplier"},{default:t(()=>[e(w,{modelValue:o.supplier,"onUpdate:modelValue":l[13]||(l[13]=a=>o.supplier=a),placeholder:"请输入供应商名称"},null,8,["modelValue"])]),_:1}),e(n,{label:"采购日期",prop:"purchaseDate"},{default:t(()=>[e(te,{modelValue:o.purchaseDate,"onUpdate:modelValue":l[14]||(l[14]=a=>o.purchaseDate=a),type:"date",placeholder:"请选择采购日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(n,{label:"描述"},{default:t(()=>[e(w,{modelValue:o.description,"onUpdate:modelValue":l[15]||(l[15]=a=>o.description=a),type:"textarea",rows:3,placeholder:"请输入耗材描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),e(N,{title:"耗材详情",modelValue:A.value,"onUpdate:modelValue":l[18]||(l[18]=a=>A.value=a),width:"600px"},{default:t(()=>[r.value?(g(),D(qe,{key:0,column:2,border:""},{default:t(()=>[e(k,{label:"耗材名称"},{default:t(()=>[u(d(r.value.name),1)]),_:1}),e(k,{label:"型号/规格"},{default:t(()=>[u(d(r.value.model),1)]),_:1}),e(k,{label:"所属实验室"},{default:t(()=>[u(d(r.value.labName),1)]),_:1}),e(k,{label:"当前库存"},{default:t(()=>[e(ae,{type:Z(r.value.currentStock,r.value.minStock),size:"small"},{default:t(()=>[u(d(r.value.currentStock)+" "+d(r.value.unit),1)]),_:1},8,["type"])]),_:1}),e(k,{label:"最低库存"},{default:t(()=>[u(d(r.value.minStock)+" "+d(r.value.unit),1)]),_:1}),e(k,{label:"单价"},{default:t(()=>[u(" ¥"+d(r.value.unitPrice),1)]),_:1}),e(k,{label:"供应商"},{default:t(()=>[u(d(r.value.supplier),1)]),_:1}),e(k,{label:"采购日期"},{default:t(()=>[u(d(r.value.purchaseDate),1)]),_:1}),e(k,{label:"使用次数"},{default:t(()=>[u(d(r.value.usageCount),1)]),_:1}),e(k,{label:"创建时间"},{default:t(()=>[u(d(r.value.createdAt),1)]),_:1}),e(k,{label:"描述",span:2},{default:t(()=>[u(d(r.value.description||"无"),1)]),_:1})]),_:1})):$("",!0)]),_:1},8,["modelValue"]),e(N,{title:"使用耗材",modelValue:R.value,"onUpdate:modelValue":l[23]||(l[23]=a=>R.value=a),width:"500px"},{footer:t(()=>[e(i,{onClick:l[22]||(l[22]=a=>R.value=!1)},{default:t(()=>[...l[45]||(l[45]=[u("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:we,loading:C.value},{default:t(()=>[...l[46]||(l[46]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(B,{model:S,rules:ne,ref_key:"useFormRef",ref:W,"label-width":"100px"},{default:t(()=>[e(n,{label:"使用数量",prop:"quantity"},{default:t(()=>{var a;return[e(P,{modelValue:S.quantity,"onUpdate:modelValue":l[19]||(l[19]=h=>S.quantity=h),min:.01,max:(a=r.value)==null?void 0:a.currentStock,precision:2,style:{width:"100%"}},null,8,["modelValue","max"])]}),_:1}),e(n,{label:"使用人员",prop:"userId"},{default:t(()=>[e(w,{modelValue:S.userId,"onUpdate:modelValue":l[20]||(l[20]=a=>S.userId=a),placeholder:"请输入使用人员ID"},null,8,["modelValue"])]),_:1}),e(n,{label:"使用目的",prop:"purpose"},{default:t(()=>[e(w,{modelValue:S.purpose,"onUpdate:modelValue":l[21]||(l[21]=a=>S.purpose=a),type:"textarea",rows:3,placeholder:"请输入使用目的"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(N,{title:"补货",modelValue:Y.value,"onUpdate:modelValue":l[29]||(l[29]=a=>Y.value=a),width:"500px"},{footer:t(()=>[e(i,{onClick:l[28]||(l[28]=a=>Y.value=!1)},{default:t(()=>[...l[47]||(l[47]=[u("取消",-1)])]),_:1}),e(i,{type:"primary",onClick:Ce,loading:C.value},{default:t(()=>[...l[48]||(l[48]=[u(" 确定 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[e(B,{model:b,rules:de,ref_key:"restockFormRef",ref:X,"label-width":"100px"},{default:t(()=>[e(n,{label:"补货数量",prop:"quantity"},{default:t(()=>[e(P,{modelValue:b.quantity,"onUpdate:modelValue":l[24]||(l[24]=a=>b.quantity=a),min:.01,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(n,{label:"单价",prop:"unitPrice"},{default:t(()=>[e(P,{modelValue:b.unitPrice,"onUpdate:modelValue":l[25]||(l[25]=a=>b.unitPrice=a),min:0,precision:2,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(n,{label:"供应商"},{default:t(()=>[e(w,{modelValue:b.supplier,"onUpdate:modelValue":l[26]||(l[26]=a=>b.supplier=a),placeholder:"请输入供应商名称"},null,8,["modelValue"])]),_:1}),e(n,{label:"备注"},{default:t(()=>[e(w,{modelValue:b.remarks,"onUpdate:modelValue":l[27]||(l[27]=a=>b.remarks=a),type:"textarea",rows:3,placeholder:"请输入备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Xl=Pe(ql,[["__scopeId","data-v-e9887148"]]);export{Xl as default};
