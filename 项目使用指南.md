# 高校实验室预约与设备管理系统 - 使用指南

## 项目概述

本项目是一个基于 Node.js + Express + MySQL + Vue.js 的高校实验室预约与设备管理系统，支持SSL安全连接TaurusDB云数据库。

## 技术栈

### 后端
- **框架**: Express.js (Node.js)
- **数据库**: MySQL (支持TaurusDB云数据库SSL连接)
- **认证**: JWT + bcryptjs
- **安全**: helmet、CORS、express-rate-limit
- **验证**: express-validator
- **开发工具**: nodemon、jest

### 前端
- **框架**: Vue.js 3
- **UI库**: Element Plus
- **HTTP客户端**: Axios
- **构建工具**: Vite

## 环境要求

- Node.js >= 16.0.0
- MySQL >= 8.0 (或TaurusDB云数据库)
- npm >= 8.0.0

## 快速开始

### 1. 项目结构
```
lab-management-system/
├── backend/                 # 后端API服务
│   ├── config/             # 配置文件
│   ├── middleware/         # 中间件
│   ├── routes/            # 路由文件
│   ├── certs/             # SSL证书目录
│   ├── .env               # 环境变量
│   └── server.js          # 服务器入口
├── frontend/              # 前端Vue应用
└── database/              # 数据库脚本
```

### 2. 数据库配置

#### 2.1 TaurusDB云数据库配置（推荐）

1. **下载SSL证书**
   - 登录TaurusDB控制台
   - 进入"实例管理"页面
   - 点击实例名称进入概览页面
   - 点击"SSL"开关右侧的"下载"
   - 将证书重命名为 `ca-bundle.pem` 并放入 `backend/certs/` 目录

2. **配置环境变量**
   编辑 `backend/.env` 文件：
   ```env
   # 数据库配置
   DB_HOST=your_taurusdb_host
   DB_PORT=3306
   DB_USER=your_username
   DB_PASSWORD=your_password
   DB_NAME=your_database_name
   
   # SSL配置
   DB_SSL_ENABLED=true
   DB_SSL_CA_PATH=./certs/ca-bundle.pem
   DB_SSL_REJECT_UNAUTHORIZED=true
   ```

#### 2.2 本地MySQL配置

如果使用本地MySQL，设置：
```env
DB_SSL_ENABLED=false
```

### 3. 后端启动

```bash
# 进入后端目录
cd backend

# 安装依赖
npm install

# 初始化数据库（首次运行）
mysql -u your_username -p your_database_name < ../database/schema.sql
mysql -u your_username -p your_database_name < ../database/sample_data.sql

# 启动开发服务器
npm run dev

# 或启动生产服务器
npm start
```

### 4. 前端启动

```bash
# 进入前端目录
cd frontend

# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### 5. 访问应用

- 前端应用: http://localhost:5173
- 后端API: http://localhost:3000
- API文档: http://localhost:3000/health (健康检查)

## 环境变量配置

### 后端环境变量 (.env)

```env
# 数据库配置
DB_HOST=your_database_host
DB_PORT=3306
DB_USER=your_username
DB_PASSWORD=your_password
DB_NAME=your_database_name

# SSL数据库连接配置 (TaurusDB)
DB_SSL_ENABLED=true
DB_SSL_CA_PATH=./certs/ca-bundle.pem
DB_SSL_REJECT_UNAUTHORIZED=true

# JWT配置
JWT_SECRET=your_jwt_secret_key
JWT_EXPIRES_IN=24h

# 服务器配置
PORT=3000
NODE_ENV=development

# 文件上传配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

## API接口说明

### 认证接口
- `POST /api/auth/register` - 用户注册
- `POST /api/auth/login` - 用户登录
- `GET /api/auth/profile` - 获取用户信息

### 用户管理
- `GET /api/users` - 获取用户列表
- `GET /api/users/:id` - 获取用户详情
- `PUT /api/users/:id` - 更新用户信息

### 实验室管理
- `GET /api/laboratories` - 获取实验室列表
- `POST /api/laboratories` - 创建实验室
- `PUT /api/laboratories/:id` - 更新实验室
- `DELETE /api/laboratories/:id` - 删除实验室

### 设备管理
- `GET /api/equipment` - 获取设备列表
- `POST /api/equipment` - 添加设备
- `PUT /api/equipment/:id` - 更新设备
- `DELETE /api/equipment/:id` - 删除设备

### 预约管理
- `GET /api/reservations` - 获取预约列表
- `POST /api/reservations` - 创建预约
- `PUT /api/reservations/:id` - 更新预约
- `DELETE /api/reservations/:id` - 取消预约

### 课程管理
- `GET /api/courses` - 获取课程列表
- `POST /api/courses` - 创建课程
- `PUT /api/courses/:id` - 更新课程
- `DELETE /api/courses/:id` - 删除课程

## 数据库结构

主要数据表：
- `users` - 用户表
- `laboratories` - 实验室表
- `equipment` - 设备表
- `reservations` - 预约表
- `courses` - 课程表

详细结构请参考 `database/schema.sql`

## 开发指南

### 添加新的API接口

1. 在 `routes/` 目录下创建或编辑路由文件
2. 使用 `middleware/auth.js` 进行身份验证
3. 使用 `middleware/validation.js` 进行数据验证
4. 使用 `config/database.js` 进行数据库操作

### 前端开发

1. 在 `frontend/src/views/` 下创建页面组件
2. 在 `frontend/src/api/` 下添加API调用方法
3. 使用 `frontend/src/router/` 配置路由

## 部署指南

### 生产环境部署

1. **环境配置**
   ```env
   NODE_ENV=production
   DB_SSL_ENABLED=true
   ```

2. **构建前端**
   ```bash
   cd frontend
   npm run build
   ```

3. **启动后端**
   ```bash
   cd backend
   npm start
   ```

4. **使用PM2管理进程**
   ```bash
   npm install -g pm2
   pm2 start server.js --name "lab-management"
   ```

### Docker部署（可选）

```dockerfile
# Dockerfile示例
FROM node:16-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install --production
COPY . .
EXPOSE 3000
CMD ["npm", "start"]
```

## 故障排除

### 常见问题

1. **数据库连接失败**
   - 检查数据库配置信息
   - 确认SSL证书路径正确
   - 验证网络连接

2. **前端无法访问后端API**
   - 检查CORS配置
   - 确认后端服务正常运行
   - 验证API地址配置

3. **SSL证书问题**
   - 确认证书文件存在且可读
   - 检查证书格式是否正确
   - 验证证书是否过期

### 日志查看

- 后端日志：控制台输出
- 数据库连接日志：启动时显示
- 错误日志：详细错误信息会在控制台显示

## 安全注意事项

1. **生产环境**
   - 修改默认JWT密钥
   - 使用HTTPS协议
   - 定期更新依赖包

2. **数据库安全**
   - 使用强密码
   - 启用SSL连接
   - 定期备份数据

3. **API安全**
   - 实施请求限流
   - 验证所有输入数据
   - 使用适当的HTTP状态码

## 联系支持

如有问题，请查看：
1. 项目README文档
2. 数据库配置说明
3. API接口文档

---

**版本**: 1.0.0  
**最后更新**: 2024年10月29日