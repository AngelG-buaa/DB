import{_ as Q}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                  */import{u as G,r as h,b as x,o as H,ah as J,c,d as V,f as t,w as s,k as m,a5 as K,e as g,N as W,j as p,F as X,y as Y,z as T,ai as Z,t as ee,P as te,Q as ae,E as le,l as se,m as oe,n as ne,p as re,h as ie,ak as de,a8 as pe,al as ue,am as _e,aq as ce,ae as me}from"./index-0407e335.js";import{getUsersApi as ge,deleteUserApi as fe}from"./user-08aa0f2d.js";import{getCoursesApi as ye}from"./course-750d183b.js";const ve={class:"user-list"},be={class:"card-header"},he={class:"search-area"},Ce={class:"pagination"},we={__name:"List",setup(ze){const f=G(),y=h(!1),C=h([]),w=h([]),r=x({user_name:"",user_type:"",course_id:null}),o=x({page:1,size:20,total:0}),U=a=>({Student:"primary",Teacher:"success",Admin:"warning"})[a]||"info",S=a=>({Student:"学生",Teacher:"教师",Admin:"管理员"})[a]||a,d=async()=>{try{y.value=!0;const a={page:o.page,page_size:o.size,role:(r.user_type||"").toLowerCase()||void 0,search:r.user_name||void 0},e=await ge(a);if(e.code===200){const v=e.data.list||[];C.value=v.map(n=>({user_id:n.id,user_name:n.name||n.username,user_type:(n.role||"").replace(/^\w/,b=>b.toUpperCase()),created_at:n.created_at})),o.total=e.data.total||0}}catch{m.error("加载用户列表失败")}finally{y.value=!1}},z=async()=>{try{const a=await ye({page:1,page_size:200});a.code===200&&(w.value=(a.data.list||[]).map(e=>({course_id:e.id||e.course_id,course_name:e.name||e.course_name})))}catch{m.error("加载课程列表失败")}},B=()=>{o.page=1,d()},A=()=>{Object.assign(r,{user_name:"",user_type:"",course_id:null}),o.page=1,d()},L=()=>{f.push("/user/create")},M=a=>{f.push(`/user/edit/${a.user_id}`)},$=a=>{f.push(`/reservation/list?user_id=${a.user_id}`)},F=async a=>{try{await te.confirm(`确定要删除用户"${a.user_name}"吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await fe(a.user_id),m.success("删除成功"),d()}catch(e){e!=="cancel"&&m.error("删除失败")}},I=a=>{o.size=a,o.page=1,d()},j=a=>{o.page=a,d()};return H(()=>{d(),z()}),J(()=>{d(),z()}),(a,e)=>{const v=ae,n=le,b=se,u=oe,_=ne,E=re,D=ie,i=de,N=pe,P=ue,R=_e,O=K,q=ce;return c(),V("div",ve,[t(O,null,{header:s(()=>[g("div",be,[e[6]||(e[6]=g("span",null,"用户管理",-1)),t(n,{type:"primary",onClick:L},{default:s(()=>[t(v,null,{default:s(()=>[t(W(me))]),_:1}),e[5]||(e[5]=p(" 新增用户 ",-1))]),_:1})])]),default:s(()=>[g("div",he,[t(D,{model:r,inline:""},{default:s(()=>[t(u,{label:"用户名"},{default:s(()=>[t(b,{modelValue:r.user_name,"onUpdate:modelValue":e[0]||(e[0]=l=>r.user_name=l),placeholder:"请输入用户名",clearable:"",style:{width:"200px"}},null,8,["modelValue"])]),_:1}),t(u,{label:"用户类型"},{default:s(()=>[t(E,{modelValue:r.user_type,"onUpdate:modelValue":e[1]||(e[1]=l=>r.user_type=l),placeholder:"请选择用户类型",clearable:""},{default:s(()=>[t(_,{label:"学生",value:"Student"}),t(_,{label:"教师",value:"Teacher"}),t(_,{label:"管理员",value:"Admin"})]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"课程"},{default:s(()=>[t(E,{modelValue:r.course_id,"onUpdate:modelValue":e[2]||(e[2]=l=>r.course_id=l),placeholder:"请选择课程",clearable:"",filterable:""},{default:s(()=>[(c(!0),V(X,null,Y(w.value,l=>(c(),T(_,{key:l.course_id,label:l.course_name,value:l.course_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(u,null,{default:s(()=>[t(n,{type:"primary",onClick:B},{default:s(()=>[...e[7]||(e[7]=[p("搜索",-1)])]),_:1}),t(n,{onClick:A},{default:s(()=>[...e[8]||(e[8]=[p("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),Z((c(),T(P,{data:C.value,stripe:"",style:{width:"100%"}},{default:s(()=>[t(i,{prop:"user_id",label:"用户ID",width:"80"}),t(i,{prop:"user_name",label:"用户名","min-width":"120"}),t(i,{prop:"user_type",label:"用户类型",width:"100"},{default:s(({row:l})=>[t(N,{type:U(l.user_type)},{default:s(()=>[p(ee(S(l.user_type)),1)]),_:2},1032,["type"])]),_:1}),t(i,{prop:"course_name",label:"所属课程","min-width":"150"}),t(i,{prop:"major",label:"专业","min-width":"120"}),t(i,{prop:"grade",label:"年级",width:"80"}),t(i,{prop:"created_at",label:"创建时间",width:"160"}),t(i,{label:"操作",width:"200",fixed:"right"},{default:s(({row:l})=>[t(n,{type:"primary",size:"small",onClick:k=>M(l)},{default:s(()=>[...e[9]||(e[9]=[p(" 编辑 ",-1)])]),_:1},8,["onClick"]),t(n,{type:"info",size:"small",onClick:k=>$(l)},{default:s(()=>[...e[10]||(e[10]=[p(" 预约记录 ",-1)])]),_:1},8,["onClick"]),t(n,{type:"danger",size:"small",onClick:k=>F(l)},{default:s(()=>[...e[11]||(e[11]=[p(" 删除 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,y.value]]),g("div",Ce,[t(R,{"current-page":o.page,"onUpdate:currentPage":e[3]||(e[3]=l=>o.page=l),"page-size":o.size,"onUpdate:pageSize":e[4]||(e[4]=l=>o.size=l),"page-sizes":[10,20,50,100],total:o.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:j},null,8,["current-page","page-size","total"])])]),_:1})])}}},De=Q(we,[["__scopeId","data-v-2bd59ac8"]]);export{De as default};
