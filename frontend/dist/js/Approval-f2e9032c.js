import{r as b,b as L,o as K,c,d as x,f as t,w as a,aF as T,k as g,a5 as Q,x as W,e as C,j as n,F as X,y as Z,z as R,ai as ee,t as _,A as $,P as S,E as te,n as ae,p as le,m as oe,ap as ne,h as se,ak as ie,a8 as re,al as de,am as ue,an as pe,ao as _e,aq as me}from"./index-0407e335.js";import{_ as ve}from"./_plugin-vue_export-helper-383fd9f4.js";/* empty css                   *//* empty css                  *//* empty css                   *//* empty css                             *//* empty css                *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                  *//* empty css                 *//* empty css                        *//* empty css                    */import"./el-tooltip-4ed993c7.js";/* empty css                             *//* empty css                  */const ce={class:"reservation-approval"},fe={class:"card-header"},be={class:"header-actions"},ge={class:"filter-section"},ye={class:"pagination-wrapper"},ke={key:0,class:"detail-content"},Ee={key:0},we={__name:"Approval",setup(Ce){const A=b(!1),y=b(!1),B=b([]),M=b([]),k=b([]),r=b(null),d=L({status:"",lab_id:null,dateRange:[]}),m=L({page:1,size:20,total:0}),f=async()=>{var s,e;A.value=!0;try{const o={page:m.page,page_size:m.size,status:d.status==="待审批"?"pending":d.status==="已批准"?"confirmed":d.status==="已拒绝"?"cancelled":void 0,laboratory_id:d.lab_id||void 0,date_from:(s=d.dateRange)==null?void 0:s[0],date_to:(e=d.dateRange)==null?void 0:e[1]},{code:u,data:E}=await(await T(()=>import("./reservation-e2a96893.js"),["js/reservation-e2a96893.js","js/index-0407e335.js","css/index-5da0789f.css"])).getReservationsApi(o);u===200&&(B.value=(E.list||[]).map(i=>{var z,D;return{reservation_id:i.id,user_name:((z=i.user)==null?void 0:z.name)||"",lab_name:((D=i.laboratory)==null?void 0:D.name)||"",reservation_date:i.reservation_date,reservation_time:`${i.start_time}-${i.end_time}`,student_number:i.participant_count||0,reservation_status:i.status==="pending"?"待审批":i.status==="confirmed"?"已批准":i.status==="cancelled"?"已拒绝":"已完成",created_at:i.created_at}}),m.total=E.total||0)}catch{g.error("加载预约列表失败")}finally{A.value=!1}},F=async()=>{try{const{code:s,data:e}=await(await T(()=>import("./lab-ae8b6f89.js"),["js/lab-ae8b6f89.js","js/index-0407e335.js","css/index-5da0789f.css"])).getLabsApi({page:1,page_size:100});s===200&&(M.value=(e.list||[]).map(o=>({lab_id:o.id,lab_name:o.name})))}catch{g.error("加载实验室列表失败")}},U=s=>{k.value=s},V=async(s,e)=>{const o=e==="已批准"?"通过":"拒绝";try{await S.confirm(`确定要${o}这个预约申请吗？`,"确认操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const u=await T(()=>import("./reservation-e2a96893.js"),["js/reservation-e2a96893.js","js/index-0407e335.js","css/index-5da0789f.css"]);e==="已批准"?await u.approveReservationApi(s.reservation_id,{}):await u.rejectReservationApi(s.reservation_id,{}),g.success(`预约${o}成功`),y.value=!1,f()}catch(u){u!=="cancel"&&g.error("操作失败，请重试")}},I=async s=>{const e=s==="已批准"?"通过":"拒绝";try{await S.confirm(`确定要批量${e}选中的 ${k.value.length} 个预约申请吗？`,"确认批量操作",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"});const o=k.value.map(u=>u.reservation_id);g.success(`批量${e}成功`),f()}catch(o){o!=="cancel"&&g.error("批量操作失败，请重试")}},O=s=>{r.value=s,y.value=!0},P=s=>({待审批:"warning",已批准:"success",已拒绝:"danger"})[s]||"info",j=()=>{Object.assign(d,{status:"",lab_id:null,dateRange:[]}),f()};return K(()=>{f(),F()}),(s,e)=>{const o=te,u=ae,E=le,i=oe,z=ne,D=se,p=ie,Y=re,N=de,h=ue,q=Q,v=pe,G=_e,H=W,J=me;return c(),x("div",ce,[t(q,null,{header:a(()=>[C("div",fe,[e[13]||(e[13]=C("span",null,"预约审批",-1)),C("div",be,[t(o,{type:"success",disabled:!k.value.length,onClick:e[0]||(e[0]=l=>I("已批准"))},{default:a(()=>[...e[11]||(e[11]=[n(" 批量通过 ",-1)])]),_:1},8,["disabled"]),t(o,{type:"danger",disabled:!k.value.length,onClick:e[1]||(e[1]=l=>I("已拒绝"))},{default:a(()=>[...e[12]||(e[12]=[n(" 批量拒绝 ",-1)])]),_:1},8,["disabled"])])])]),default:a(()=>[C("div",ge,[t(D,{model:d,inline:""},{default:a(()=>[t(i,{label:"状态"},{default:a(()=>[t(E,{modelValue:d.status,"onUpdate:modelValue":e[2]||(e[2]=l=>d.status=l),placeholder:"请选择状态",clearable:""},{default:a(()=>[t(u,{label:"待审批",value:"待审批"}),t(u,{label:"已批准",value:"已批准"}),t(u,{label:"已拒绝",value:"已拒绝"})]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"实验室"},{default:a(()=>[t(E,{modelValue:d.lab_id,"onUpdate:modelValue":e[3]||(e[3]=l=>d.lab_id=l),placeholder:"请选择实验室",clearable:""},{default:a(()=>[(c(!0),x(X,null,Z(M.value,l=>(c(),R(u,{key:l.lab_id,label:l.lab_name,value:l.lab_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{label:"预约日期"},{default:a(()=>[t(z,{modelValue:d.dateRange,"onUpdate:modelValue":e[4]||(e[4]=l=>d.dateRange=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),t(i,null,{default:a(()=>[t(o,{type:"primary",onClick:f},{default:a(()=>[...e[14]||(e[14]=[n("查询",-1)])]),_:1}),t(o,{onClick:j},{default:a(()=>[...e[15]||(e[15]=[n("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),ee((c(),R(N,{data:B.value,onSelectionChange:U},{default:a(()=>[t(p,{type:"selection",width:"55"}),t(p,{prop:"reservation_id",label:"预约ID",width:"80"}),t(p,{prop:"user_name",label:"申请人",width:"100"}),t(p,{prop:"lab_name",label:"实验室",width:"120"}),t(p,{prop:"reservation_date",label:"预约日期",width:"120"}),t(p,{prop:"reservation_time",label:"预约时间",width:"120"}),t(p,{prop:"student_number",label:"学生人数",width:"100"}),t(p,{prop:"reservation_status",label:"状态",width:"100"},{default:a(({row:l})=>[t(Y,{type:P(l.reservation_status),size:"small"},{default:a(()=>[n(_(l.reservation_status),1)]),_:2},1032,["type"])]),_:1}),t(p,{prop:"created_at",label:"申请时间",width:"150"}),t(p,{label:"操作",width:"200",fixed:"right"},{default:a(({row:l})=>[l.reservation_status==="待审批"?(c(),R(o,{key:0,type:"success",size:"small",onClick:w=>V(l,"已批准")},{default:a(()=>[...e[16]||(e[16]=[n(" 通过 ",-1)])]),_:1},8,["onClick"])):$("",!0),l.reservation_status==="待审批"?(c(),R(o,{key:1,type:"danger",size:"small",onClick:w=>V(l,"已拒绝")},{default:a(()=>[...e[17]||(e[17]=[n(" 拒绝 ",-1)])]),_:1},8,["onClick"])):$("",!0),t(o,{type:"primary",size:"small",onClick:w=>O(l)},{default:a(()=>[...e[18]||(e[18]=[n(" 详情 ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[J,A.value]]),C("div",ye,[t(h,{"current-page":m.page,"onUpdate:currentPage":e[5]||(e[5]=l=>m.page=l),"page-size":m.size,"onUpdate:pageSize":e[6]||(e[6]=l=>m.size=l),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:f,onCurrentChange:f},null,8,["current-page","page-size","total"])])]),_:1}),t(H,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),title:"预约详情",width:"600px"},{footer:a(()=>{var l;return[((l=r.value)==null?void 0:l.reservation_status)==="待审批"?(c(),x("div",Ee,[t(o,{type:"success",onClick:e[7]||(e[7]=w=>V(r.value,"已批准"))},{default:a(()=>[...e[19]||(e[19]=[n(" 通过 ",-1)])]),_:1}),t(o,{type:"danger",onClick:e[8]||(e[8]=w=>V(r.value,"已拒绝"))},{default:a(()=>[...e[20]||(e[20]=[n(" 拒绝 ",-1)])]),_:1})])):$("",!0),t(o,{onClick:e[9]||(e[9]=w=>y.value=!1)},{default:a(()=>[...e[21]||(e[21]=[n("关闭",-1)])]),_:1})]}),default:a(()=>[r.value?(c(),x("div",ke,[t(G,{column:2,border:""},{default:a(()=>[t(v,{label:"预约ID"},{default:a(()=>[n(_(r.value.reservation_id),1)]),_:1}),t(v,{label:"申请人"},{default:a(()=>[n(_(r.value.user_name),1)]),_:1}),t(v,{label:"实验室"},{default:a(()=>[n(_(r.value.lab_name),1)]),_:1}),t(v,{label:"预约日期"},{default:a(()=>[n(_(r.value.reservation_date),1)]),_:1}),t(v,{label:"预约时间"},{default:a(()=>[n(_(r.value.reservation_time),1)]),_:1}),t(v,{label:"学生人数"},{default:a(()=>[n(_(r.value.student_number),1)]),_:1}),t(v,{label:"状态",span:2},{default:a(()=>[t(Y,{type:P(r.value.reservation_status)},{default:a(()=>[n(_(r.value.reservation_status),1)]),_:1},8,["type"])]),_:1}),t(v,{label:"申请时间",span:2},{default:a(()=>[n(_(r.value.created_at),1)]),_:1})]),_:1})])):$("",!0)]),_:1},8,["modelValue"])])}}},Oe=ve(we,[["__scopeId","data-v-2d2fb1fe"]]);export{Oe as default};
